<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA PRO | Эволюция</title>
    <style>
        :root {
            --accent: #00d2ff;
            --bg: #030508;
            --glass: rgba(255, 255, 255, 0.02);
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; display: flex; align-items: center; justify-content: center; }

        /* Фоновый туман */
        .fog-bg { position: fixed; inset: 0; z-index: -1; background: radial-gradient(circle at 50% 50%, #0a111a, #030508); }
        .blob { position: absolute; width: 600px; height: 600px; background: var(--accent); filter: blur(150px); opacity: 0.05; animation: move 20s infinite alternate; }
        @keyframes move { from { transform: translate(-10%, -10%); } to { transform: translate(10%, 10%); } }

        /* Авторизация */
        #auth-container { width: 400px; z-index: 10; transition: 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .auth-card { background: rgba(10, 15, 25, 0.8); backdrop-filter: blur(30px); padding: 40px; border-radius: 30px; border: 1px solid var(--border); text-align: center; }
        
        .step { display: none; animation: slideUp 0.5s ease forwards; }
        .step.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        input { width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 15px; border: 1px solid var(--border); background: rgba(0,0,0,0.4); color: #fff; outline: none; }
        .btn { width: 100%; padding: 15px; background: var(--accent); border: none; border-radius: 15px; font-weight: 800; cursor: pointer; transition: 0.3s; }
        .btn:hover { box-shadow: 0 0 20px rgba(0, 210, 255, 0.4); transform: translateY(-2px); }

        /* Экран приветствия и Плюсы */
        #welcome-screen { position: fixed; inset: 0; z-index: 100; background: var(--bg); display: none; flex-direction: column; align-items: center; justify-content: center; opacity: 0; transition: 1s; }
        #feature-text { color: var(--accent); margin-top: 20px; font-size: 18px; letter-spacing: 2px; height: 24px; transition: 0.5s; }

        /* Главный интерфейс */
        #main-app { display: none; width: 98vw; height: 96vh; background: var(--glass); backdrop-filter: blur(50px); border: 1px solid var(--border); border-radius: 30px; grid-template-columns: 280px 1fr 240px; opacity: 0; transform: scale(1.05); transition: 1s cubic-bezier(0.16, 1, 0.3, 1); }
        
        #messages { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .bubble { padding: 12px 18px; border-radius: 18px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); max-width: 70%; animation: pop 0.3s ease; }
        @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div class="fog-bg"><div class="blob"></div></div>

    <div id="auth-container">
        <div class="auth-card">
            <div class="step active" id="step1">
                <h2 style="margin-bottom: 15px;">ULTRA PRO</h2>
                <p style="font-size: 13px; opacity: 0.6; margin-bottom: 25px;">Новый стандарт приватного общения</p>
                <button class="btn" onclick="nextStep(2)">НАЧАТЬ РАБОТУ</button>
                <p style="margin-top: 15px; font-size: 11px; cursor: pointer; opacity: 0.4;" onclick="setMode(false)">У меня уже есть доступ</p>
            </div>
            <div class="step" id="step2">
                <h3 id="auth-title" style="margin-bottom: 20px;">Создание Unit-а</h3>
                <input type="text" id="username" placeholder="Позывной">
                <input type="password" id="password" placeholder="Код доступа">
                <button class="btn" onclick="handleAuth()">АКТИВИРОВАТЬ</button>
            </div>
        </div>
    </div>

    <div id="welcome-screen">
        <h1 id="welcome-title" style="letter-spacing: 10px;">ИНИЦИАЛИЗАЦИЯ</h1>
        <div id="feature-text">Подготовка протоколов...</div>
        <div style="width: 200px; height: 1px; background: var(--border); margin-top: 30px; overflow: hidden;">
            <div id="progress-bar" style="width: 0%; height: 100%; background: var(--accent); transition: 0.4s;"></div>
        </div>
    </div>

    <div id="main-app">
        <aside style="border-right: 1px solid var(--border); padding: 30px;">
            <div style="color: var(--accent); font-weight: 900; letter-spacing: 2px; margin-bottom: 40px;">SECTORS</div>
            <div style="color: var(--accent); background: rgba(0, 210, 255, 0.05); padding: 12px; border-radius: 10px;"># основной-чат</div>
        </aside>
        
        <main style="display: flex; flex-direction: column;">
            <div id="messages"></div>
            <form id="chat-form" style="padding: 30px; display: flex; gap: 10px;">
                <input type="text" id="msg-input" placeholder="Передача данных..." style="margin: 0;">
                <button type="submit" class="btn" style="width: auto; padding: 0 30px;">ОТПРАВИТЬ</button>
            </form>
        </main>

        <aside style="border-left: 1px solid var(--border); padding: 30px;">
            <div style="font-size: 10px; opacity: 0.4; margin-bottom: 20px;">ОНЛАЙН</div>
            <div id="user-display" style="font-weight: bold;">ярослав</div>
        </aside>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let isReg = true;

        function nextStep(n) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + n).classList.add('active');
        }

        function setMode(mode) {
            isReg = mode;
            document.getElementById('auth-title').innerText = isReg ? "Создание Unit-а" : "Авторизация";
            nextStep(2);
        }

        function handleAuth() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            if(u && p) socket.emit('authenticate', { username: u, password: p, isRegister: isReg });
        }

        socket.on('auth_success', d => {
            const auth = document.getElementById('auth-container');
            auth.style.opacity = '0';
            auth.style.transform = 'translateY(-20px)';
            
            setTimeout(() => {
                auth.style.display = 'none';
                const ws = document.getElementById('welcome-screen');
                ws.style.display = 'flex';
                setTimeout(() => ws.style.opacity = '1', 50);

                const features = [
                    "БЕЗОПАСНОСТЬ: Включено шифрование",
                    "СКОРОСТЬ: Оптимизация Socket.io",
                    "СТИЛЬ: Интерфейс Ultra Glass",
                    "ПРИВАТНОСТЬ: Локальное хранение",
                    "ДОСТУП ПРЕДОСТАВЛЕН"
                ];

                let i = 0;
                const interval = setInterval(() => {
                    document.getElementById('feature-text').innerText = features[i];
                    document.getElementById('progress-bar').style.width = ((i+1)/features.length*100) + '%';
                    i++;
                    if(i >= features.length) {
                        clearInterval(interval);
                        setTimeout(showApp, 1000);
                    }
                }, 1200);
            }, 800);
        });

        function showApp() {
            const ws = document.getElementById('welcome-screen');
            ws.style.opacity = '0';
            setTimeout(() => {
                ws.style.display = 'none';
                const app = document.getElementById('main-app');
                app.style.display = 'grid';
                setTimeout(() => {
                    app.style.opacity = '1';
                    app.style.transform = 'scale(1)';
                }, 50);
            }, 1000);
            socket.emit('join_room', 'main');
        }

        socket.on('message', m => {
            const d = document.createElement('div');
            d.className = 'bubble';
            if(m.name === document.getElementById('username').value) d.style.alignSelf = 'flex-end';
            d.innerHTML = `<small style="color:var(--accent)">${m.name}</small><br>${m.text}`;
            document.getElementById('messages').appendChild(d);
            document.getElementById('messages').scrollTop = 99999;
        });

        document.getElementById('chat-form').onsubmit = (e) => {
            e.preventDefault();
            const i = document.getElementById('msg-input');
            if(i.value) { socket.emit('message', { text: i.value }); i.value = ''; }
        };
    </script>
</body>
</html>
