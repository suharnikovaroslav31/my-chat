<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Speeky OS | Liquid Ether Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #00f2ff;
            --accent-soft: rgba(0, 242, 255, 0.2);
            --bg: #030508;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --text-main: #ffffff;
            --text-dim: rgba(255, 255, 255, 0.5);
            --curve: cubic-bezier(0.22, 1, 0.36, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text-main); height: 100vh; overflow: hidden; }

        /* --- –ñ–ò–í–û–ô –§–û–ù: –û–ë–õ–ê–ö–û –ü–û –í–û–î–ï --- */
        #liquid-bg {
            position: fixed; inset: 0; z-index: -1;
            background: linear-gradient(45deg, #000, #040a0f, #00151a);
            overflow: hidden;
        }
        .wave {
            position: absolute; width: 200vw; height: 200vw; top: -50%; left: -50%;
            background: radial-gradient(circle, var(--accent-soft) 0%, transparent 50%);
            filter: blur(80px); opacity: 0.4;
            animation: move 25s infinite alternate ease-in-out;
        }
        .wave:nth-child(2) { background: radial-gradient(circle, #7000ff1a 0%, transparent 50%); animation-delay: -5s; animation-duration: 30s; }
        @keyframes move {
            0% { transform: translate(0, 0) scale(1) rotate(0deg); }
            50% { transform: translate(10%, 15%) scale(1.2) rotate(90deg); }
            100% { transform: translate(-5%, -10%) scale(0.9) rotate(180deg); }
        }

        /* --- –°–ò–°–¢–ï–ú–ê –ü–õ–ê–í–ù–û–°–¢–ò --- */
        .page {
            position: absolute; inset: 0; display: none; padding: 25px;
            flex-direction: column; opacity: 0; transform: scale(1.05) translateY(30px);
            filter: blur(20px); transition: all 1s var(--curve);
        }
        .page.active {
            display: flex; opacity: 1; transform: scale(1) translateY(0); filter: blur(0px);
        }

        /* --- –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –û–°–¢–†–û–í–û–ö --- */
        .island-container {
            position: fixed; top: 15px; left: 0; width: 100%;
            display: flex; justify-content: center; z-index: 1000;
        }
        .island {
            background: rgba(0, 0, 0, 0.8); border: 1px solid var(--border);
            border-radius: 30px; padding: 8px 20px; min-width: 120px;
            backdrop-filter: blur(20px); display: flex; align-items: center; gap: 12px;
            transition: all 0.6s var(--curve); cursor: pointer;
        }
        .island:hover { min-width: 200px; border-color: var(--accent); }
        .status-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 10px var(--accent); }

        /* --- –°–ï–†–¨–ï–ó–ù–ê–Ø –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø --- */
        .auth-box {
            max-width: 400px; width: 100%; margin: auto;
            background: var(--glass); border: 1px solid var(--border);
            border-radius: 45px; padding: 50px 40px;
            backdrop-filter: blur(60px); box-shadow: 0 40px 100px rgba(0,0,0,0.5);
            text-align: center;
        }
        .auth-box h1 { font-size: 38px; font-weight: 900; margin-bottom: 8px; letter-spacing: -1.5px; }
        .auth-box p { color: var(--text-dim); font-size: 14px; margin-bottom: 40px; }

        .input-group { position: relative; margin-bottom: 20px; }
        .input-group input {
            width: 100%; background: rgba(255,255,255,0.03); border: 1px solid var(--border);
            padding: 22px 25px; border-radius: 24px; color: #fff; font-size: 16px;
            transition: all 0.4s var(--curve);
        }
        .input-group input:focus {
            background: rgba(255,255,255,0.06); border-color: var(--accent);
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.15);
        }

        .btn-prime {
            width: 100%; padding: 22px; background: var(--accent); color: #000;
            border: none; border-radius: 24px; font-weight: 900; font-size: 16px;
            text-transform: uppercase; cursor: pointer; transition: 0.4s var(--curve);
            box-shadow: 0 15px 35px rgba(0, 242, 255, 0.3);
        }
        .btn-prime:hover { transform: translateY(-5px); box-shadow: 0 20px 45px rgba(0, 242, 255, 0.5); }

        /* --- –°–ü–ò–°–û–ö –ß–ê–¢–û–í (–°–¢–ï–ö–õ–û) --- */
        .chat-card {
            background: var(--glass); border: 1px solid var(--border);
            border-radius: 35px; padding: 25px; margin-bottom: 15px;
            display: flex; align-items: center; gap: 20px;
            transition: all 0.4s var(--curve); cursor: pointer;
        }
        .chat-card:hover {
            background: rgba(255,255,255,0.06); border-color: var(--accent);
            transform: scale(1.02) translateX(10px);
        }
        .avatar-fake {
            width: 60px; height: 60px; border-radius: 22px;
            background: linear-gradient(45deg, var(--accent), #7000ff);
            display: flex; align-items: center; justify-content: center; font-weight: 900;
        }

        /* --- –ü–õ–ê–í–ù–´–ô –ß–ê–¢ --- */
        #msg-flow {
            flex: 1; display: flex; flex-direction: column; gap: 15px;
            overflow-y: auto; padding: 100px 0 200px; scroll-behavior: smooth;
        }
        .msg {
            max-width: 80%; padding: 18px 24px; border-radius: 30px;
            font-size: 15px; line-height: 1.6; position: relative;
            animation: slideIn 0.8s var(--curve) forwards;
            backdrop-filter: blur(10px);
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(40px) scale(0.9); filter: blur(10px); }
            to { opacity: 1; transform: translateY(0) scale(1); filter: blur(0px); }
        }
        .msg.me {
            align-self: flex-end; background: var(--accent); color: #000;
            font-weight: 600; border-bottom-right-radius: 5px;
        }
        .msg.he {
            align-self: flex-start; background: var(--glass);
            border: 1px solid var(--border); border-bottom-left-radius: 5px;
        }

        /* --- –ü–ê–ù–ï–õ–¨ –í–í–û–î–ê --- */
        .input-dock {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 500px; z-index: 100;
            background: rgba(10, 12, 15, 0.9); border: 1px solid var(--border);
            padding: 10px; border-radius: 50px; backdrop-filter: blur(30px);
            display: none; align-items: center; box-shadow: 0 25px 60px rgba(0,0,0,0.5);
        }
        .input-dock.active { display: flex; animation: slideIn 0.6s var(--curve); }
        .input-dock input {
            flex: 1; background: transparent; border: none; padding: 15px 25px;
            color: #fff; font-size: 16px;
        }
        .send-btn {
            width: 50px; height: 50px; background: var(--accent); border: none;
            border-radius: 50%; cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
        }

        /* --- BOTTOM NAV --- */
        .nav-bar {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 50px; background: rgba(0,0,0,0.8);
            padding: 15px 45px; border-radius: 50px; border: 1px solid var(--border);
            backdrop-filter: blur(20px); z-index: 90;
        }
        .nav-item { font-size: 26px; opacity: 0.3; cursor: pointer; transition: 0.4s var(--curve); }
        .nav-item.active { opacity: 1; color: var(--accent); transform: scale(1.3); }

    </style>
</head>
<body>

    <div id="liquid-bg">
        <div class="wave"></div>
        <div class="wave"></div>
    </div>

    <div class="island-container">
        <div class="island" id="dynamic-island">
            <div class="status-dot"></div>
            <span id="island-text" style="font-size: 12px; font-weight: 600;">Speeky OS System Online</span>
        </div>
    </div>

    <section id="page-auth" class="page active">
        <div class="auth-box">
            <h1>Speeky OS</h1>
            <p>Ether Foundation v.8</p>
            <div class="input-group">
                <input type="text" id="reg-name" placeholder="Username">
            </div>
            <div class="input-group">
                <input type="email" id="reg-mail" placeholder="Email address">
            </div>
            <button class="btn-prime" onclick="handleAuth()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É</button>
        </div>
    </section>

    <section id="page-chats" class="page">
        <h2 style="font-size: 42px; font-weight: 900; margin-bottom: 30px;">–°–æ–æ–±—â–µ–Ω–∏—è</h2>
        <div id="chats-container"></div>
        <button class="btn-prime" style="background: none; border: 1px solid var(--border); color: var(--accent); margin-top: 20px;" onclick="startNewChat()">+ –ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥</button>
    </section>

    <section id="page-room" class="page">
        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
            <div onclick="navigate('chats')" style="cursor: pointer; opacity: 0.5;">‚Üê –ù–∞–∑–∞–¥</div>
            <h2 id="current-peer">@username</h2>
        </div>
        <div id="msg-flow"></div>
    </section>

    <section id="page-sets" class="page">
        <h2 style="font-size: 42px; font-weight: 900; margin-bottom: 30px;">–ü—Ä–æ—Ñ–∏–ª—å</h2>
        <div class="auth-box" style="max-width: 100%; text-align: left; padding: 30px;">
            <p style="margin-bottom: 10px;">ID –ê–ö–ö–ê–£–ù–¢–ê: <span id="u-id" style="color: var(--accent);"></span></p>
            <h3 id="u-name" style="font-size: 30px; margin-bottom: 5px;"></h3>
            <p id="u-mail" style="margin-bottom: 30px;"></p>
            
            <div style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 25px;">
                <p style="font-size: 12px; opacity: 0.5; margin-bottom: 15px;">CUSTOMIZATION</p>
                <label style="font-size: 14px;">–°–∏–ª–∞ —Ä–∞–∑–º—ã—Ç–∏—è (Glass Blur)</label>
                <input type="range" min="10" max="100" value="50" style="width: 100%; margin: 15px 0;" oninput="updateGlass(this.value)">
            </div>

            <button onclick="logout()" style="margin-top: 30px; background: none; border: none; color: #ff4d4d; font-weight: 900; cursor: pointer;">–í–´–ô–¢–ò –ò–ó –û–°</button>
        </div>
    </section>

    <div id="input-dock" class="input-dock">
        <input type="text" id="msg-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter') pushMessage()">
        <button class="send-btn" onclick="pushMessage()">‚ûî</button>
    </div>

    <nav class="nav-bar" id="global-nav" style="display: none;">
        <div class="nav-item active" id="nav-chats" onclick="navigate('chats')">üí¨</div>
        <div class="nav-item" id="nav-sets" onclick="navigate('sets')">‚öôÔ∏è</div>
    </nav>

    <script>
        const API = 'https://my-chat-itp3.onrender.com/messages';
        const DB_ID = 'SPEEKY_ETHER_V8';
        let USER = JSON.parse(localStorage.getItem(DB_ID));
        let PEER = null;
        let LAST_DATA_HASH = "";

        function handleAuth() {
            const n = document.getElementById('reg-name').value.trim().replace('@','');
            const e = document.getElementById('reg-mail').value.trim();
            if(!n || !e) return alert("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏");

            USER = {
                name: n,
                email: e,
                id: 'SPK-' + Math.floor(Math.random() * 99999),
                registered: new Date().toLocaleDateString()
            };
            localStorage.setItem(DB_ID, JSON.stringify(USER));
            updateIsland("System Initialized...");
            setTimeout(() => location.reload(), 800);
        }

        function navigate(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            setTimeout(() => {
                const target = document.getElementById('page-' + page);
                target.classList.add('active');
            }, 50);

            document.getElementById('input-dock').classList.toggle('active', page === 'room');
            document.getElementById('global-nav').style.display = (page === 'auth') ? 'none' : 'flex';
            
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            const navIcon = document.getElementById('nav-' + (page === 'room' ? 'chats' : page));
            if(navIcon) navIcon.classList.add('active');
        }

        function updateIsland(txt) {
            const island = document.getElementById('dynamic-island');
            const label = document.getElementById('island-text');
            label.style.opacity = '0';
            setTimeout(() => {
                label.innerText = txt;
                label.style.opacity = '1';
            }, 300);
        }

        function updateGlass(v) {
            document.documentElement.style.setProperty('--blur', v + 'px');
        }

        function startNewChat() {
            const p = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:");
            if(p) {
                PEER = p.replace('@','');
                document.getElementById('current-peer').innerText = '@' + PEER;
                navigate('room');
                sync();
            }
        }

        async function pushMessage() {
            const input = document.getElementById('msg-input');
            const val = input.value.trim();
            if(!val || !PEER) return;
            
            input.value = '';
            updateIsland("Sending...");

            await fetch(API, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ from: USER.name, to: PEER, text: val, time: Date.now() })
            });
            
            updateIsland("Message Delivered");
            sync();
        }

        async function sync() {
            try {
                const res = await fetch(API);
                const data = await res.json();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å –∑—Ä—è –∏ –∏–∑–±–µ–∂–∞—Ç—å –º–µ—Ä—Ü–∞–Ω–∏—è
                const currentHash = JSON.stringify(data.slice(-10));
                if(currentHash === LAST_DATA_HASH) return;
                LAST_DATA_HASH = currentHash;

                if(PEER) {
                    const flow = document.getElementById('msg-flow');
                    const filtered = data.filter(m => (m.from === USER.name && m.to === PEER) || (m.from === PEER && m.to === USER.name));
                    
                    // –£–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞
                    flow.innerHTML = '';
                    filtered.forEach(m => {
                        const d = document.createElement('div');
                        d.className = `msg ${m.from === USER.name ? 'me' : 'he'}`;
                        d.innerText = m.text;
                        flow.appendChild(d);
                    });
                    flow.scrollTop = flow.scrollHeight;
                }

                // –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
                const contacts = new Set();
                data.forEach(m => {
                    if(m.from === USER.name) contacts.add(m.to);
                    if(m.to === USER.name) contacts.add(m.from);
                });

                const container = document.getElementById('chats-container');
                container.innerHTML = '';
                contacts.forEach(c => {
                    const card = document.createElement('div');
                    card.className = 'chat-card';
                    card.innerHTML = `
                        <div class="avatar-fake">${c[0].toUpperCase()}</div>
                        <div>
                            <div style="font-weight: 900; font-size: 18px;">@${c}</div>
                            <div style="font-size: 12px; opacity: 0.4;">Secure Encrypted Channel</div>
                        </div>
                    `;
                    card.onclick = () => {
                        PEER = c;
                        document.getElementById('current-peer').innerText = '@' + c;
                        navigate('room');
                    };
                    container.appendChild(card);
                });
            } catch(e) { console.error("Sync Error"); }
        }

        function logout() {
            if(confirm("–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–æ—Ä–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ?")) {
                localStorage.removeItem(DB_ID);
                location.reload();
            }
        }

        // –ó–∞–ø—É—Å–∫
        if(USER) {
            document.getElementById('u-name').innerText = '@' + USER.name;
            document.getElementById('u-mail').innerText = USER.email;
            document.getElementById('u-id').innerText = USER.id;
            navigate('chats');
            setInterval(sync, 3000);
            sync();
        } else {
            navigate('auth');
        }
    </script>
</body>
</html>
