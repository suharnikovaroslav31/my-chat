<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Speeky | Ultra Glass</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #9d50ff;
            --accent-glow: rgba(157, 80, 255, 0.5);
            --bg-gradient: radial-gradient(circle at 50% 50%, #1a1033 0%, #050505 100%);
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg-gradient); 
            color: #fff; height: 100vh; width: 100vw; 
            overflow: hidden; position: fixed;
        }

        /* 1. –ü–†–ò–í–ï–¢–°–¢–í–ï–ù–ù–´–ô –≠–ö–†–ê–ù (–¢–û–ß–¨-–í-–¢–û–ß–¨ –ö–ê–ö –ù–ê –°–ö–†–ò–ù–ï) */
        #welcome-screen {
            position: fixed; inset: 0; z-index: 2000;
            background: var(--bg-gradient);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 20px; transition: 0.8s cubic-bezier(0.8, 0, 0.2, 1);
        }
        .welcome-glow {
            position: absolute; width: 300px; height: 300px;
            background: var(--accent); filter: blur(120px); opacity: 0.3; z-index: -1;
        }
        #welcome-screen h1 { font-size: 56px; font-weight: 800; letter-spacing: -2px; margin-bottom: 10px; }
        #welcome-screen p { opacity: 0.6; font-size: 18px; max-width: 280px; line-height: 1.4; }
        .click-to-continue { margin-top: 50px; font-size: 10px; opacity: 0.4; letter-spacing: 2px; text-transform: uppercase; }

        /* 2. –ö–ê–†–¢–û–ß–ö–ê –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò/–ü–†–û–§–ò–õ–Ø */
        #auth-screen {
            position: fixed; inset: 0; z-index: 1000; 
            display: none; align-items: center; justify-content: center; padding: 20px;
            background: rgba(0,0,0,0.4); backdrop-filter: blur(10px);
        }
        .profile-card {
            width: 100%; max-width: 350px; background: var(--glass);
            border-radius: 30px; border: 1px solid var(--glass-border);
            overflow: hidden; box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }
        .card-header { height: 120px; background: linear-gradient(to bottom, var(--accent), #502591); position: relative; }
        .avatar-wrap {
            width: 90px; height: 90px; border-radius: 50%; border: 5px solid #1a1033;
            position: absolute; bottom: -45px; left: 25px; overflow: hidden; background: #333;
        }
        .card-body { padding: 55px 25px 30px; }
        .card-body h2 { font-size: 24px; font-weight: 800; }
        .card-body p { font-size: 13px; opacity: 0.5; margin-top: 5px; }
        
        .input-speeky {
            width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
            padding: 15px 20px; border-radius: 15px; color: #fff; margin-top: 20px; outline: none;
        }
        .btn-speeky {
            width: 100%; padding: 15px; background: var(--accent); border: none;
            border-radius: 15px; color: #fff; font-weight: 700; margin-top: 15px;
            box-shadow: 0 10px 20px var(--accent-glow);
        }

        /* 3. –ì–õ–ê–í–ù–´–ô –ò–ù–¢–ï–†–§–ï–ô–° –ú–ï–°–°–ï–ù–î–ñ–ï–†–ê */
        #main-app { display: none; height: 100vh; flex-direction: column; }
        .top-nav { height: 70px; display: flex; align-items: center; padding: 0 20px; border-bottom: 1px solid var(--glass-border); }
        
        .chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 80%; padding: 12px 18px; border-radius: 20px; font-size: 15px; line-height: 1.4; }
        .message.in { background: var(--glass); align-self: flex-start; border-bottom-left-radius: 5px; }
        .message.out { background: var(--accent); align-self: flex-end; border-bottom-right-radius: 5px; }

        .bottom-bar { padding: 20px; background: rgba(0,0,0,0.2); backdrop-filter: blur(20px); display: flex; gap: 10px; }
        .msg-input { flex: 1; background: var(--glass); border: 1px solid var(--glass-border); padding: 14px 20px; border-radius: 25px; color: #fff; outline: none; }
        .send-btn { width: 50px; height: 50px; border-radius: 50%; background: var(--accent); border: none; display: flex; align-items: center; justify-content: center; font-size: 20px; }

    </style>
</head>
<body onclick="handleGlobalClick()">

    <div class="welcome-glow"></div>

    <div id="welcome-screen">
        <h1 id="welcome-text">–ü—Ä–∏–≤–µ—Ç</h1>
        <p id="welcome-sub">–¢–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –æ–±—â–µ–Ω–∏—è –±–µ–∑ –≥—Ä–∞–Ω–∏—Ü.</p>
        <div class="click-to-continue">–ö–ª–∏–∫–Ω–∏, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</div>
    </div>

    <div id="auth-screen">
        <div class="profile-card">
            <div class="card-header"></div>
            <div class="avatar-wrap">
                <img src="https://i.pravatar.cc/100" style="width:100%">
            </div>
            <div class="card-body">
                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                <p>–í—ã–±–µ—Ä–∏ —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø—Å–µ–≤–¥–æ–Ω–∏–º –¥–ª—è —Å–µ—Ç–∏ Speeky.</p>
                <input type="text" id="username" class="input-speeky" placeholder="@nickname" autocomplete="off">
                <button class="btn-speeky" onclick="startApp()">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</button>
            </div>
        </div>
    </div>

    <div id="main-app">
        <header class="top-nav">
            <div style="font-weight: 800; font-size: 18px; color: var(--accent);">Speeky</div>
            <div style="margin-left: auto; font-size: 12px; opacity: 0.5;">–û–Ω–ª–∞–π–Ω: <span id="online-count">1</span></div>
        </header>

        <div class="chat-area" id="chat-box">
            <div class="message in">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Speeky! üëã</div>
        </div>

        <div class="bottom-bar">
            <input type="text" id="m-input" class="msg-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
            <button class="send-btn" onclick="sendMsg()">üöÄ</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let step = 0;
        let myNick = "";

        // –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–∞—Ö
        function handleGlobalClick() {
            if (step === 0) {
                const text = document.getElementById('welcome-text');
                const sub = document.getElementById('welcome-sub');
                
                text.style.opacity = '0';
                setTimeout(() => {
                    text.innerText = "–û–±—â–∞–π—Å—è";
                    sub.innerText = "–û—Ç–ø—Ä–∞–≤–ª—è–π —Ç–µ–∫—Å—Ç—ã, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –º–µ–¥–∏–∞ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.";
                    text.style.opacity = '1';
                }, 400);
                step = 1;
            } else if (step === 1) {
                document.getElementById('welcome-screen').style.transform = 'translateY(-100%)';
                document.getElementById('auth-screen').style.display = 'flex';
                step = 2;
            }
        }

        function startApp() {
            const user = document.getElementById('username').value;
            if(!user) return;
            myNick = user;

            document.getElementById('auth-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'flex';
                socket.emit('authenticate', { username: myNick });
            }, 500);
        }

        function sendMsg() {
            const inp = document.getElementById('m-input');
            if(inp.value) {
                socket.emit('message', { text: inp.value });
                inp.value = '';
            }
        }

        socket.on('message', m => {
            const box = document.getElementById('chat-box');
            const isMe = m.name === myNick;
            const div = document.createElement('div');
            div.className = `message ${isMe ? 'out' : 'in'}`;
            div.innerHTML = `
                ${!isMe ? `<div style="font-size:10px; font-weight:800; margin-bottom:4px;">${m.name}</div>` : ''}
                ${m.text}
            `;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });

        socket.on('update_online', count => {
            document.getElementById('online-count').innerText = count;
        });
    </script>
</body>
</html>
