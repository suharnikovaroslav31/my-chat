<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA CORE | FINAL STABLE</title>
    <style>
        :root {
            --accent: #00d2ff;
            --accent-glow: rgba(0, 210, 255, 0.4);
            --bg: #020406;
            --glass: rgba(15, 20, 25, 0.8);
            --border: rgba(255, 255, 255, 0.08);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; }

        /* –ñ–∏–≤–æ–π —Ñ–æ–Ω */
        #canvas-bg { position: fixed; inset: 0; z-index: -1; background: radial-gradient(circle at center, #0a111a 0%, #020406 100%); }
        .nebula { position: absolute; width: 100%; height: 100%; background: url('https://www.transparenttextures.com/patterns/stardust.png'); opacity: 0.1; animation: drift 100s linear infinite; }
        @keyframes drift { from { background-position: 0 0; } to { background-position: 1000px 1000px; } }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen { position: fixed; inset: 0; z-index: 1000; background: var(--bg); display: flex; align-items: center; justify-content: center; transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .hidden { opacity: 0; pointer-events: none; transform: scale(1.05); filter: blur(10px); }

        /* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è */
        .auth-card { background: var(--glass); backdrop-filter: blur(30px); padding: 40px; border-radius: 35px; border: 1px solid var(--border); width: 380px; text-align: center; box-shadow: 0 30px 60px rgba(0,0,0,0.5); }
        input { width: 100%; padding: 16px; margin-bottom: 15px; border-radius: 14px; border: 1px solid var(--border); background: rgba(0,0,0,0.4); color: #fff; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }
        .btn-main { width: 100%; padding: 16px; background: var(--accent); color: #000; border: none; border-radius: 14px; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .btn-main:hover { transform: translateY(-2px); box-shadow: 0 10px 20px var(--accent-glow); }

        /* –ì–õ–ê–í–ù–´–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        #app { display: flex; width: 100vw; height: 100vh; }

        /* –õ–µ–≤–∞—è —É–∑–∫–∞—è –ø–∞–Ω–µ–ª—å */
        .rail { width: 75px; background: rgba(0,0,0,0.5); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 25px 0; gap: 20px; flex-shrink: 0; }
        .r-btn { width: 50px; height: 50px; border-radius: 18px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; font-size: 20px; border: 1px solid transparent; }
        .r-btn:hover { background: rgba(255,255,255,0.05); }
        .r-btn.active { background: var(--accent); color: #000; box-shadow: 0 0 20px var(--accent-glow); }

        /* –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ */
        .sidebar { width: 300px; background: rgba(5, 8, 15, 0.4); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
        .search-area { padding: 20px; }
        .c-item { padding: 15px 20px; margin: 0 10px 5px; border-radius: 15px; display: flex; align-items: center; gap: 15px; cursor: pointer; transition: 0.2s; }
        .c-item:hover { background: rgba(255,255,255,0.03); }
        .c-item.active { background: var(--accent-glow); border: 1px solid rgba(0,210,255,0.2); }
        .avatar { width: 45px; height: 45px; border-radius: 14px; background: var(--accent); display: flex; align-items: center; justify-content: center; font-weight: 900; color: #000; }

        /* –ß–ê–¢ */
        .viewport { flex-grow: 1; display: flex; flex-direction: column; background: rgba(0,0,0,0.1); }
        .v-header { height: 75px; border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 30px; justify-content: space-between; backdrop-filter: blur(10px); }
        
        #messages { flex-grow: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; gap: 15px; }
        .bubble { padding: 14px 18px; border-radius: 20px; background: var(--glass); border: 1px solid var(--border); max-width: 70%; line-height: 1.5; animation: slideUp 0.4s ease-out; }
        .bubble.me { align-self: flex-end; background: rgba(0, 210, 255, 0.05); border-color: rgba(0, 210, 255, 0.2); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px) scale(0.95); } }

        .input-area { padding: 25px 35px; }
        .i-box { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 20px; padding: 10px 25px; display: flex; align-items: center; gap: 15px; }
        #msg-input { flex-grow: 1; background: none; border: none; color: #fff; padding: 10px 0; outline: none; font-size: 16px; }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–µ–∑–∂–∞—é—â–∏–µ */
        #settings-side { position: fixed; left: -400px; top: 0; bottom: 0; width: 350px; background: #05080c; z-index: 2000; border-right: 1px solid var(--border); transition: 0.5s cubic-bezier(0.8, 0, 0.2, 1); padding: 40px; box-shadow: 20px 0 50px rgba(0,0,0,0.5); }
        #settings-side.open { left: 0; }
    </style>
</head>
<body>

    <div id="canvas-bg"><div class="nebula"></div></div>

    <div id="screen-auth" class="screen">
        <div class="auth-card">
            <h1 style="letter-spacing: 4px; margin-bottom: 30px; font-weight: 200;">ULTRA CORE</h1>
            <input type="text" id="username" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn-main" onclick="auth()">–ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø</button>
        </div>
    </div>

    <div id="app" class="hidden">
        <nav class="rail">
            <div class="r-btn active">üí¨</div>
            <div class="r-btn" onclick="toggleSettings()">‚öôÔ∏è</div>
            <div class="r-btn" style="margin-top: auto;" onclick="location.reload()">üö™</div>
        </nav>

        <aside class="sidebar">
            <div class="search-area">
                <input type="text" placeholder="–ü–æ–∏—Å–∫..." style="margin-bottom: 0; padding: 10px; font-size: 14px;">
            </div>
            <div class="c-item active">
                <div class="avatar">#</div>
                <div>
                    <div style="font-weight: 700;">–æ—Å–Ω–æ–≤–Ω–æ–π-—á–∞—Ç</div>
                    <div style="font-size: 12px; color: #00ff88;">–ø—É–±–ª–∏—á–Ω—ã–π —Å–µ–∫—Ç–æ—Ä</div>
                </div>
            </div>
        </aside>

        <main class="viewport">
            <header class="v-header">
                <div>
                    <h3 id="chat-title"># –æ—Å–Ω–æ–≤–Ω–æ–π-—á–∞—Ç</h3>
                    <p style="font-size: 12px; color: #00ff88;">‚óè <span id="online-count">1</span> –≤ —Å–µ—Ç–∏</p>
                </div>
                <div style="opacity: 0.3; font-size: 12px;">v4.0 STABLE</div>
            </header>

            <div id="messages"></div>

            <div class="input-area">
                <form id="chat-form" class="i-box">
                    <input type="text" id="msg-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
                    <button type="submit" style="background:none; border:none; color:var(--accent); font-weight:900; cursor:pointer;">–û–¢–ü–†–ê–í–ò–¢–¨</button>
                </form>
            </div>
        </main>
    </div>

    <div id="settings-side">
        <h2 style="margin-bottom: 30px;">–ü—Ä–æ—Ñ–∏–ª—å</h2>
        <div style="text-align: center; margin-bottom: 30px;">
            <div style="width: 80px; height: 80px; background: var(--accent); border-radius: 25px; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 30px; color: #000; font-weight: 900;" id="user-avatar">?</div>
            <h3 id="user-name-display">User</h3>
        </div>
        <div style="display: grid; gap: 15px;">
            <div style="padding: 15px; background: rgba(255,255,255,0.03); border-radius: 12px; font-size: 14px;">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –ê–∫—Ç–∏–≤–Ω—ã</div>
            <div style="padding: 15px; background: rgba(255,255,255,0.03); border-radius: 12px; font-size: 14px;">üé® –¢–µ–º–∞: Deep Space</div>
        </div>
        <button class="btn-main" style="margin-top: 40px; background: #ff4444; color: #fff;" onclick="toggleSettings()">–ó–ê–ö–†–´–¢–¨</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myNick = "";

        // –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
        function auth() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            if(!u) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!");
            
            myNick = u;
            socket.emit('authenticate', { username: u, password: p, isRegister: true });
        }

        socket.on('auth_success', data => {
            document.getElementById('screen-auth').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('user-name-display').innerText = myNick;
            document.getElementById('user-avatar').innerText = myNick[0].toUpperCase();
            socket.emit('join_room', 'main');
        });

        // –°–ß–ï–¢–ß–ò–ö –û–ù–õ–ê–ô–ù–ê
        socket.on('room_users', (users) => {
            document.getElementById('online-count').innerText = Object.keys(users).length;
        });

        // –ß–ê–¢ (–û–¢–ü–†–ê–í–ö–ê)
        const form = document.getElementById('chat-form');
        form.onsubmit = (e) => {
            e.preventDefault();
            const input = document.getElementById('msg-input');
            if(input.value.trim()) {
                socket.emit('message', { text: input.value });
                input.value = '';
            }
        };

        // –ß–ê–¢ (–ü–†–ò–ï–ú)
        socket.on('message', m => {
            const container = document.getElementById('messages');
            const div = document.createElement('div');
            const isMe = m.name === myNick;
            
            div.className = `bubble ${isMe ? 'me' : ''}`;
            div.innerHTML = `
                <div style="font-size: 10px; font-weight: 900; color: var(--accent); margin-bottom: 4px; text-transform: uppercase;">
                    ${m.name}
                </div>
                <div>${m.text}</div>
            `;
            
            container.appendChild(div);
            // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
            container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
        });

        // –ò–ù–¢–ï–†–§–ï–ô–°
        function toggleSettings() {
            document.getElementById('settings-side').classList.toggle('open');
        }
    </script>
</body>
</html>
