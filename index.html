<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA GLASS ELITE</title>
    <style>
        :root {
            --accent: #00d2ff;
            --accent-glow: rgba(0, 210, 255, 0.3);
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --bg-dark: #05070a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-dark); color: white; height: 100vh; overflow: hidden; display: flex; align-items: center; justify-content: center; }

        /* –§–æ–Ω–æ–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è */
        .bg-layer { position: fixed; inset: 0; z-index: -1; background: radial-gradient(circle at 20% 30%, #0a111a 0%, #05070a 100%); }
        .glow { position: absolute; width: 800px; height: 800px; background: radial-gradient(circle, rgba(0, 210, 255, 0.07) 0%, transparent 70%); filter: blur(120px); animation: move 25s infinite alternate ease-in-out; }
        @keyframes move { from { transform: translate(-20%, -20%); } to { transform: translate(20%, 20%); } }

        /* –≠–ö–†–ê–ù –í–•–û–î–ê */
        #auth-screen { position: fixed; inset: 0; z-index: 1000; background: var(--bg-dark); display: flex; align-items: center; justify-content: center; }
        .auth-card { background: rgba(15, 20, 30, 0.9); padding: 50px; border-radius: 32px; border: 1px solid var(--border); width: 400px; text-align: center; backdrop-filter: blur(50px); }
        .auth-card input { width: 100%; padding: 16px; margin-bottom: 15px; border-radius: 16px; border: 1px solid var(--border); background: #000; color: #fff; outline: none; }
        .auth-btn { width: 100%; padding: 16px; background: var(--accent); border: none; border-radius: 16px; font-weight: 800; cursor: pointer; color: #000; transition: 0.3s; }
        .auth-btn:hover { filter: brightness(1.2); box-shadow: 0 0 20px var(--accent-glow); }

        /* –ì–õ–ê–í–ù–´–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        #main-app { display: none; width: 98vw; height: 96vh; background: var(--glass); backdrop-filter: blur(50px) saturate(200%); border: 1px solid var(--border); border-radius: 28px; grid-template-columns: 280px 1fr 240px; box-shadow: 0 50px 100px rgba(0,0,0,0.6); }

        .sidebar-left, .sidebar-right { background: rgba(0,0,0,0.2); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-right { border-right: none; border-left: 1px solid var(--border); padding: 25px; }
        .nav-header { padding: 30px; font-weight: 900; letter-spacing: 2px; color: var(--accent); font-size: 14px; }
        .channel-item { padding: 14px 25px; margin: 2px 15px; border-radius: 12px; cursor: pointer; transition: 0.3s; color: #666; display: flex; align-items: center; gap: 12px; }
        .channel-item.active { background: var(--accent-glow); color: var(--accent); border: 1px solid rgba(0, 210, 255, 0.2); }

        .chat-area { display: flex; flex-direction: column; }
        .chat-header { padding: 20px 30px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        #messages { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }

        .bubble { padding: 15px 20px; border-radius: 20px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); max-width: 80%; }
        .msg-mine { align-self: flex-end; border-color: var(--accent-glow); background: rgba(0, 210, 255, 0.05); }

        .input-wrap { padding: 25px; }
        #chat-form { background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 10px 20px; border-radius: 20px; display: flex; gap: 15px; }
        #msg-input { flex: 1; background: none; border: none; color: white; outline: none; }

        /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–†–û–§–ò–õ–Ø */
        #profile-modal { display: none; position: fixed; inset: 0; z-index: 2000; background: rgba(0,0,0,0.8); backdrop-filter: blur(20px); align-items: center; justify-content: center; }
        .modal-content { background: rgba(20, 25, 35, 0.95); border: 1px solid var(--border); padding: 40px; border-radius: 30px; width: 400px; text-align: center; }
        .modal-content input { width: 100%; padding: 12px; margin: 15px 0; border-radius: 12px; background: #000; border: 1px solid var(--border); color: #fff; outline: none; }
        .save-btn { width: 100%; padding: 15px; background: var(--accent); border: none; border-radius: 15px; font-weight: 800; cursor: pointer; }
    </style>
</head>
<body>
    <div class="bg-layer"><div class="glow"></div></div>

    <div id="auth-screen">
        <div class="auth-card">
            <h1 id="auth-title" style="margin-bottom: 30px; letter-spacing: 3px;">ULTRA<span style="color:var(--accent)">PRO</span></h1>
            <input type="text" id="username" placeholder="–ù–∏–∫–Ω–µ–π–º">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
            <p id="error-msg" style="color: #ff4d4d; font-size: 12px; margin-bottom: 10px;"></p>
            <button class="auth-btn" onclick="handleAuth()">–í–û–ô–¢–ò</button>
            <p style="margin-top: 20px; font-size: 12px; cursor: pointer; opacity: 0.5;" onclick="toggleReg()" id="reg-toggle">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</p>
        </div>
    </div>

    <div id="main-app">
        <aside class="sidebar-left">
            <div class="nav-header">–ö–ê–ù–ê–õ–´</div>
            <div class="channel-item active"><span>#</span> –æ—Å–Ω–æ–≤–Ω–æ–π-—á–∞—Ç</div>
            <div class="channel-item"><span>#</span> –∏–¥–µ–∏-–ø—Ä–æ–µ–∫—Ç–∞</div>
            <div style="margin-top: auto; padding: 25px; border-top: 1px solid var(--border); cursor: pointer;" onclick="openProfile()">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width:40px; height:40px; border-radius:12px; background:var(--accent); display:flex; align-items:center; justify-content:center; font-weight:900; color:#000;">üë§</div>
                    <div>
                        <div id="my-name-display" style="font-weight: 700;">User</div>
                        <div id="my-status-display" style="font-size: 10px; opacity: 0.5;">–í —Å–µ—Ç–∏</div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="chat-area">
            <header class="chat-header">
                <div># <strong id="room-name">–æ—Å–Ω–æ–≤–Ω–æ–π-—á–∞—Ç</strong></div>
            </header>
            <div id="messages"></div>
            <div class="input-wrap">
                <form id="chat-form">
                    <input type="text" id="msg-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
                    <button type="submit" style="background:none; border:none; color:var(--accent); font-weight:800; cursor:pointer;">–û–¢–ü–†–ê–í–ò–¢–¨</button>
                </form>
            </div>
        </main>

        <aside class="sidebar-right">
            <div style="font-size: 12px; font-weight: 800; color: #444; margin-bottom: 20px;">–í –°–ï–¢–ò</div>
            <div id="online-list">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <div style="width: 8px; height: 8px; background: #00ff88; border-radius: 50%;"></div>
                    <span id="online-user">—è—Ä–æ—Å–ª–∞–≤</span>
                </div>
            </div>
        </aside>
    </div>

    <div id="profile-modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 20px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h2>
            <label style="font-size: 12px; color: var(--accent); text-align: left; display: block;">–í–ê–® –°–¢–ê–¢–£–°</label>
            <input type="text" id="edit-status" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞—Ç—É—Å...">
            <label style="font-size: 12px; color: var(--accent); text-align: left; display: block;">–¶–í–ï–¢ –ù–ò–ö–ê</label>
            <input type="color" id="edit-color" style="height: 50px; cursor: pointer;">
            <button class="save-btn" onclick="saveProfile()">–°–û–•–†–ê–ù–ò–¢–¨</button>
            <p style="margin-top: 15px; cursor: pointer; opacity: 0.5;" onclick="closeProfile()">–ó–∞–∫—Ä—ã—Ç—å</p>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let isRegister = false;
        let myNick = '';

        function toggleReg() {
            isRegister = !isRegister;
            document.getElementById('auth-title').innerText = isRegister ? '–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø' : 'ULTRA PRO';
            document.querySelector('.auth-btn').innerText = isRegister ? '–°–û–ó–î–ê–¢–¨' : '–í–û–ô–¢–ò';
            document.getElementById('reg-toggle').innerText = isRegister ? '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏' : '–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç';
        }

        function handleAuth() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            if(u && p) socket.emit('authenticate', { username: u, password: p, isRegister });
        }

        function openProfile() { document.getElementById('profile-modal').style.display = 'flex'; }
        function closeProfile() { document.getElementById('profile-modal').style.display = 'none'; }

        function saveProfile() {
            const status = document.getElementById('edit-status').value;
            const color = document.getElementById('edit-color').value;
            socket.emit('update_profile', { status, color });
            closeProfile();
        }

        socket.on('auth_error', m => document.getElementById('error-msg').innerText = m);
        
        socket.on('auth_success', d => {
            myNick = d.username;
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'grid';
            document.getElementById('my-name-display').innerText = d.username;
            document.getElementById('my-name-display').style.color = d.profile.color;
            document.getElementById('my-status-display').innerText = d.profile.status;
            socket.emit('join_room', '–æ—Å–Ω–æ–≤–Ω–æ–π-—á–∞—Ç');
        });

        socket.on('profile_updated', d => {
            document.getElementById('my-status-display').innerText = d.status;
            document.getElementById('my-name-display').style.color = d.color;
        });

        socket.on('message', m => {
            const d = document.createElement('div');
            const isMe = m.name === myNick;
            d.className = `bubble ${isMe ? 'msg-mine' : ''}`;
            d.innerHTML = `<small style="color:${m.color || 'var(--accent)'}; font-weight:800;">${m.name}</small><br>${m.text}`;
            document.getElementById('messages').appendChild(d);
            document.getElementById('messages').scrollTop = 99999;
        });

        socket.on('load_history', h => {
            document.getElementById('messages').innerHTML = '';
            h.forEach(m => {
                const d = document.createElement('div');
                d.className = `bubble ${m.name === myNick ? 'msg-mine' : ''}`;
                d.innerHTML = `<small style="color:${m.color || 'var(--accent)'}; font-weight:800;">${m.name}</small><br>${m.text}`;
                document.getElementById('messages').appendChild(d);
            });
            document.getElementById('messages').scrollTop = 99999;
        });

        document.getElementById('chat-form').onsubmit = (e) => {
            e.preventDefault();
            const i = document.getElementById('msg-input');
            if(i.value) {
                socket.emit('message', { text: i.value });
                i.value = '';
            }
        };
    </script>
</body>
</html>
