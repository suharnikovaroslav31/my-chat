<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Speeky | Ultimate Interface</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #00f2ff;
            --bg: #050608;
            --panel: #0f1117;
            --island-bg: rgba(20, 24, 35, 0.9);
            --border: rgba(255, 255, 255, 0.08);
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        
        body { background: var(--bg); color: #fff; height: 100vh; width: 100vw; overflow: hidden; display: flex; }

        /* --- –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–ö–ê–ù–ê–õ–´) --- */
        #sidebar {
            width: 260px; background: var(--panel); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; transition: 0.3s;
        }
        @media (max-width: 768px) { #sidebar { display: none; } } /* –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã */

        .side-header { padding: 25px 20px; font-weight: 800; font-size: 14px; color: var(--accent); letter-spacing: 1px; }
        .channel-link { padding: 12px 20px; cursor: pointer; opacity: 0.6; display: flex; align-items: center; gap: 10px; }
        .channel-link.active { opacity: 1; background: rgba(0, 242, 255, 0.05); border-left: 3px solid var(--accent); }

        /* --- –ì–õ–ê–í–ù–ê–Ø –ó–û–ù–ê --- */
        #main-container { flex: 1; display: flex; flex-direction: column; position: relative; background: var(--bg); }

        .chat-header { height: 60px; border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 20px; background: rgba(0,0,0,0.2); }

        #chat-scroller { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 180px; scroll-behavior: smooth; }

        /* --- –°–û–û–ë–©–ï–ù–ò–Ø --- */
        .msg-row { display: flex; flex-direction: column; margin-bottom: 15px; width: 100%; }
        .msg-bubble { 
            max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 15px; line-height: 1.4;
            background: var(--panel); border: 1px solid var(--border); align-self: flex-start;
        }
        .msg-row.me .msg-bubble { background: var(--accent); color: #000; align-self: flex-end; font-weight: 500; }
        .msg-meta { font-size: 10px; opacity: 0.4; margin-bottom: 4px; display: flex; gap: 10px; }

        /* --- –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –û–°–¢–†–û–í–û–ö –ò –í–í–û–î --- */
        .island-controller {
            position: fixed; bottom: calc(20px + var(--safe-area-bottom)); left: 50%; 
            transform: translateX(-50%); width: 92%; max-width: 450px;
            display: flex; flex-direction: column; gap: 10px; z-index: 999;
        }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–ø–µ—Ä—å —á–∞—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–∞–¥ –æ—Å—Ç—Ä–æ–≤–∫–æ–º */
        .input-bar {
            background: var(--island-bg); backdrop-filter: blur(20px);
            border-radius: 25px; border: 1px solid var(--border);
            padding: 8px 15px; display: flex; align-items: center; gap: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .input-bar input {
            flex: 1; background: none; border: none; color: #fff; padding: 10px 5px; outline: none; font-size: 15px;
        }

        /* –ü–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–û—Å—Ç—Ä–æ–≤–æ–∫) */
        .island-nav {
            background: var(--island-bg); backdrop-filter: blur(20px);
            border-radius: 30px; border: 1px solid var(--border);
            display: flex; justify-content: space-around; padding: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .nav-btn { padding: 10px; opacity: 0.4; transition: 0.2s; cursor: pointer; font-size: 20px; }
        .nav-btn.active { opacity: 1; color: var(--accent); transform: scale(1.1); }

        /* –≠–ö–†–ê–ù –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò */
        #auth-layer {
            position: fixed; inset: 0; z-index: 10000; background: var(--bg);
            display: flex; align-items: center; justify-content: center;
        }
        .auth-form { width: 320px; text-align: center; }
        .auth-input { width: 100%; padding: 15px; border-radius: 15px; background: var(--panel); border: 1px solid var(--border); color: #fff; margin-bottom: 10px; outline: none; }
        .auth-btn { width: 100%; padding: 15px; border-radius: 15px; background: var(--accent); color: #000; border: none; font-weight: 800; cursor: pointer; }

        /* –ú–û–î–ê–õ–ö–ò (–ö–û–ù–¢–ê–ö–¢–´/–ù–ê–°–¢–†–û–ô–ö–ò) */
        .modal {
            position: absolute; bottom: 150px; width: 100%; left: 0; padding: 20px;
            display: none; flex-direction: column; gap: 10px; z-index: 998;
            background: var(--bg); border-radius: 30px 30px 0 0; border-top: 1px solid var(--border);
            max-height: 70vh; overflow-y: auto;
        }
        .modal.open { display: flex; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

    </style>
</head>
<body>

    <div id="auth-layer">
        <div class="auth-form">
            <h1 style="margin-bottom: 30px;">Speeky Cloud</h1>
            <input type="email" id="a-email" class="auth-input" placeholder="Email">
            <input type="text" id="a-nick" class="auth-input" placeholder="–ù–∏–∫–Ω–µ–π–º">
            <button class="auth-btn" onclick="initSystem()">–í–û–ô–¢–ò</button>
        </div>
    </div>

    <aside id="sidebar">
        <div class="side-header">–ö–ê–ù–ê–õ–´</div>
        <div class="channel-link active"># –æ—Å–Ω–æ–≤–Ω–æ–π-—á–∞—Ç</div>
        <div class="channel-link"># —Ñ–ª—É–¥–∏–ª–∫–∞</div>
        <div class="channel-link"># –Ω–æ–≤–æ—Å—Ç–∏</div>
        <div class="channel-link"># dev-logs</div>
    </aside>

    <main id="main-container">
        <header class="chat-header">
            <b id="chan-name"># –æ—Å–Ω–æ–≤–Ω–æ–π-—á–∞—Ç</b>
            <div style="margin-left: auto; font-size: 10px; color: #0f8;">ONLINE</div>
        </header>

        <div id="chat-scroller">
            </div>

        <div id="modal-contacts" class="modal">
            <h3>üë§ –ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
            <div style="padding: 15px; background: var(--panel); border-radius: 15px;">–Ø—Ä–æ—Å–ª–∞–≤ (Online)</div>
            <div style="padding: 15px; background: var(--panel); border-radius: 15px;">Swimer (Offline)</div>
        </div>

        <div id="modal-settings" class="modal">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            <p>–ê–∫–∫–∞—É–Ω—Ç: <span id="set-nick">...</span></p>
            <button onclick="localStorage.clear(); location.reload();" style="color:red; background:none; border:none; text-align:left; padding:10px 0;">–£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –≤—ã–π—Ç–∏</button>
        </div>

        <div class="island-controller">
            <div class="input-bar" id="input-zone">
                <input type="text" id="m-text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
                <button onclick="sendMsg()" style="background:var(--accent); border:none; width:35px; height:35px; border-radius:50%; font-weight:900;">></button>
            </div>

            <nav class="island-nav">
                <div class="nav-btn active" onclick="showView('chat', this)">üí¨</div>
                <div class="nav-btn" onclick="showView('contacts', this)">üë§</div>
                <div class="nav-btn" onclick="showView('create', this)">‚äï</div>
                <div class="nav-btn" onclick="showView('settings', this)">‚öôÔ∏è</div>
            </nav>
        </div>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let user = JSON.parse(localStorage.getItem('user'));

        if(user) hideAuth();

        function initSystem() {
            const email = document.getElementById('a-email').value;
            const nick = document.getElementById('a-nick').value;
            if(!email.includes('@')) return alert('Check Email!');
            
            user = { email, nick, id: Date.now() };
            localStorage.setItem('user', JSON.stringify(user));
            hideAuth();
        }

        function hideAuth() {
            document.getElementById('auth-layer').style.display = 'none';
            document.getElementById('set-nick').innerText = user.nick;
            socket.emit('authenticate', { username: user.nick });
        }

        // –õ–æ–≥–∏–∫–∞ –û—Å—Ç—Ä–æ–≤–∫–∞
        function showView(type, el) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('open'));
            el.classList.add('active');

            if(type === 'contacts') document.getElementById('modal-contacts').classList.add('open');
            if(type === 'settings') document.getElementById('modal-settings').classList.add('open');
            if(type === 'chat') {
                // –ü—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª–∫–∏
            }
        }

        // –ß–ê–¢
        function sendMsg() {
            const input = document.getElementById('m-text');
            if(input.value.trim()) {
                socket.emit('message', { text: input.value, name: user.nick });
                input.value = '';
            }
        }

        socket.on('message', m => {
            const scroller = document.getElementById('chat-scroller');
            const isMe = m.name === user.nick;
            const div = document.createElement('div');
            div.className = `msg-row ${isMe ? 'me' : ''}`;
            div.innerHTML = `
                <div class="msg-meta"><span>${m.name}</span> <span>${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span></div>
                <div class="msg-bubble">${m.text}</div>
            `;
            scroller.appendChild(div);
            scroller.scrollTop = scroller.scrollHeight;
        });

        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        const mInput = document.getElementById('m-text');
        mInput.addEventListener('focus', () => {
            if(window.innerWidth < 768) {
                document.querySelector('.island-nav').style.display = 'none';
            }
        });
        mInput.addEventListener('blur', () => {
            document.querySelector('.island-nav').style.display = 'flex';
        });

        document.getElementById('m-text').onkeypress = (e) => { if(e.key === 'Enter') sendMsg(); };
    </script>
</body>
</html>
