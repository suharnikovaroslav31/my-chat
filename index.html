<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Speeky | Deep Interface</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #00f2ff;
            --bg: #030406;
            --card: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.07);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        
        /* –ñ–ò–í–û–ô –ó–ê–î–ù–ò–ô –§–û–ù */
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; position: relative; }
        .bg-glow { 
            position: absolute; width: 300px; height: 300px; background: var(--accent); 
            filter: blur(150px); opacity: 0.1; border-radius: 50%; z-index: -1; animation: move 20s infinite alternate;
        }
        @keyframes move { from { top: 10%; left: 10%; } to { top: 60%; left: 70%; } }

        /* –≠–ö–†–ê–ù–´ */
        .screen { display: none; flex: 1; flex-direction: column; padding: 25px; padding-bottom: 180px; overflow-y: auto; z-index: 1; }
        .screen.active { display: flex; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } }

        .screen-header h1 { font-size: 34px; font-weight: 800; letter-spacing: -1.5px; }
        .screen-header p { opacity: 0.4; margin-bottom: 30px; font-size: 14px; }

        /* –≠–õ–ï–ú–ï–ù–¢–´ –ò–ù–¢–ï–†–§–ï–ô–°–ê */
        .glass-card { 
            background: var(--card); border: 1px solid var(--border); 
            backdrop-filter: blur(15px); border-radius: 28px; padding: 20px; margin-bottom: 15px; 
        }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .stat-item { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 20px; text-align: center; }
        .stat-item span { display: block; font-size: 20px; font-weight: 800; color: var(--accent); }
        .stat-item label { font-size: 10px; opacity: 0.5; text-transform: uppercase; }

        .ui-input { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 16px; border-radius: 18px; color: #fff; margin: 8px 0; outline: none; }
        .ui-btn { width: 100%; padding: 18px; border-radius: 18px; border: none; font-weight: 800; background: var(--accent); color: #000; cursor: pointer; transition: 0.3s; }
        .ui-btn:active { transform: scale(0.97); }

        /* –ß–ê–¢ */
        .msg { max-width: 80%; padding: 14px 18px; border-radius: 22px; background: var(--card); border: 1px solid var(--border); margin-bottom: 12px; align-self: flex-start; position: relative; }
        .msg.me { align-self: flex-end; background: var(--accent); color: #000; font-weight: 600; }

        /* –û–°–¢–†–û–í–û–ö (DYNAMIC ISLAND) */
        .island-box { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 420px; z-index: 1000; }
        
        .island-input-zone { 
            background: rgba(10, 12, 18, 0.8); backdrop-filter: blur(20px); 
            border: 1px solid var(--border); border-radius: 30px; padding: 10px 20px;
            display: none; align-items: center; margin-bottom: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .island-input-zone.show { display: flex; }
        .island-input-zone input { flex: 1; background: none; border: none; color: #fff; outline: none; font-size: 16px; }

        .island-nav { 
            background: rgba(15, 18, 25, 0.95); backdrop-filter: blur(30px);
            border: 1px solid var(--border); border-radius: 40px; 
            padding: 12px; display: flex; justify-content: space-around; align-items: center;
        }
        .n-icon { font-size: 24px; opacity: 0.3; transition: 0.3s; cursor: pointer; padding: 10px; }
        .n-icon.active { opacity: 1; color: var(--accent); background: rgba(255,255,255,0.05); border-radius: 50%; }

        /* AUTH */
        #auth-gate { position: fixed; inset: 0; background: var(--bg); z-index: 5000; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div class="bg-glow"></div>

    <div id="auth-gate">
        <div style="width: 85%; max-width: 350px;">
            <h1 style="font-size: 48px; letter-spacing: -2px;">Speeky</h1>
            <p style="opacity: 0.5; margin-bottom: 40px;">–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–µ.</p>
            <input type="email" id="in-email" class="ui-input" placeholder="–í–∞—à–∞ –ø–æ—á—Ç–∞">
            <input type="text" id="in-nick" class="ui-input" placeholder="@nickname">
            <button class="ui-btn" onclick="initApp()">–í–û–ô–¢–ò</button>
        </div>
    </div>

    <section id="sc-chat" class="screen active">
        <div class="screen-header">
            <h1>Speeky –ß–∞—Ç</h1>
            <p>–°–∫–≤–æ–∑–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ</p>
        </div>
        <div id="chat-flow" style="display: flex; flex-direction: column;">
            <div class="msg">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å. –í–∞—à–∞ —Å–µ—Å—Å–∏—è –∑–∞—â–∏—â–µ–Ω–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º Speeky-V3.</div>
        </div>
    </section>

    <section id="sc-contacts" class="screen">
        <div class="screen-header">
            <h1>–°–≤—è–∑–∏</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–∏–º –∫—Ä—É–≥–æ–º –æ–±—â–µ–Ω–∏—è</p>
        </div>
        <div class="glass-card">
            <input type="text" class="ui-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ ID –∏–ª–∏ –Ω–∏–∫—É...">
        </div>
        <div class="glass-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div style="width:45px; height:45px; background:linear-gradient(45deg, #00f2ff, #9d50ff); border-radius:15px;"></div>
                    <div><b>–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</b><br><small style="opacity:0.5">–í—Å–µ–≥–¥–∞ –æ–Ω–ª–∞–π–Ω</small></div>
                </div>
                <button style="background:none; border:1px solid var(--accent); color:var(--accent); padding:5px 12px; border-radius:10px; font-size:12px;">–ß–ê–¢</button>
            </div>
        </div>
    </section>

    <section id="sc-create" class="screen">
        <div class="screen-header">
            <h1>–ù–æ–≤—ã–π —É–∑–µ–ª</h1>
            <p>–°–æ–∑–¥–∞–π—Ç–µ –∫–∞–Ω–∞–ª –∏–ª–∏ –≥—Ä—É–ø–ø—É</p>
        </div>
        <div class="glass-card">
            <label style="font-size:12px; opacity:0.5;">–ù–ê–ó–í–ê–ù–ò–ï</label>
            <input type="text" id="room-name" class="ui-input" placeholder="–ù–∞–ø—Ä. Crypto-Family">
            
            <label style="font-size:12px; opacity:0.5; margin-top:15px; display:block;">–ö–ê–¢–ï–ì–û–†–ò–Ø</label>
            <div style="display:flex; gap:10px; margin-top:10px; overflow-x:auto;">
                <span style="background:var(--accent); color:#000; padding:8px 15px; border-radius:20px; font-size:12px; font-weight:800;">IT</span>
                <span style="background:var(--card); border:1px solid var(--border); padding:8px 15px; border-radius:20px; font-size:12px;">–ò–≥—Ä—ã</span>
                <span style="background:var(--card); border:1px solid var(--border); padding:8px 15px; border-radius:20px; font-size:12px;">–ú—É–∑—ã–∫–∞</span>
            </div>

            <button class="ui-btn" style="margin-top:25px;" onclick="doCreate()">–°–û–ó–î–ê–¢–¨ –ü–†–û–°–¢–†–ê–ù–°–¢–í–û</button>
        </div>
    </section>

    <section id="sc-settings" class="screen">
        <div class="screen-header">
            <h1>–ö–∞–±–∏–Ω–µ—Ç</h1>
            <p>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞—à–µ–π –ª–∏—á–Ω–æ—Å—Ç–∏</p>
        </div>
        
        <div class="glass-card" style="text-align:center;">
            <div style="width:90px; height:90px; background:var(--card); border:2px solid var(--accent); border-radius:50%; margin: 0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:40px;" id="p-avatar">?</div>
            <h2 id="p-nick">User</h2>
            <div class="stat-grid">
                <div class="stat-item"><span id="msg-count">0</span><label>–°–æ–æ–±—â–µ–Ω–∏–π</label></div>
                <div class="stat-item"><span>Cloud</span><label>–¢–∞—Ä–∏—Ñ</label></div>
            </div>
        </div>

        <div class="glass-card">
            <h3>–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</h3>
            <div style="display:flex; justify-content:space-between; margin-top:15px;">
                <span>–¢–µ–º–Ω—ã–π —Ä–µ–∂–∏–º</span>
                <input type="checkbox" checked>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:15px;">
                <span>–ó–≤—É–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</span>
                <input type="checkbox" checked>
            </div>
        </div>

        <button class="ui-btn" style="background:#ff4444; color:#fff;" onclick="logout()">–£–î–ê–õ–ò–¢–¨ –ê–ö–ö–ê–£–ù–¢</button>
    </section>

    <div class="island-box">
        <div class="island-input-zone show" id="input-zone">
            <input type="text" id="m-field" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å –≤ Speeky...">
            <button onclick="pushMsg()" style="background:var(--accent); border:none; width:35px; height:35px; border-radius:50%; font-weight:900;">></button>
        </div>
        
        <nav class="island-nav">
            <div class="n-icon active" onclick="go('chat', this)">üí¨</div>
            <div class="n-icon" onclick="go('contacts', this)">üë§</div>
            <div class="n-icon" onclick="go('create', this)">‚äï</div>
            <div class="n-icon" onclick="go('settings', this)">‚öôÔ∏è</div>
        </nav>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let session = JSON.parse(localStorage.getItem('spk_v4'));
        let mCount = localStorage.getItem('m_count') || 0;

        if(session) renderSession();

        function initApp() {
            const nick = document.getElementById('in-nick').value;
            const email = document.getElementById('in-email').value;
            if(!nick || !email.includes('@')) return alert("–î–∞–Ω–Ω—ã–µ –Ω–µ –≤–∞–ª–∏–¥–Ω—ã");

            session = { nick, email, date: new Date().toLocaleDateString() };
            localStorage.setItem('spk_v4', JSON.stringify(session));
            renderSession();
        }

        function renderSession() {
            document.getElementById('auth-gate').style.display = 'none';
            document.getElementById('p-nick').innerText = session.nick;
            document.getElementById('p-avatar').innerText = session.nick[1].toUpperCase();
            document.getElementById('msg-count').innerText = mCount;
            socket.emit('authenticate', { username: session.nick });
        }

        function go(scr, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('sc-' + scr).classList.add('active');
            
            document.querySelectorAll('.n-icon').forEach(i => i.classList.remove('active'));
            el.classList.add('active');

            const iz = document.getElementById('input-zone');
            if(scr === 'chat') iz.classList.add('show');
            else iz.classList.remove('show');
        }

        function pushMsg() {
            const f = document.getElementById('m-field');
            if(f.value.trim()) {
                socket.emit('message', { name: session.nick, text: f.value });
                f.value = '';
                mCount++;
                localStorage.setItem('m_count', mCount);
                document.getElementById('msg-count').innerText = mCount;
            }
        }

        socket.on('message', m => {
            const flow = document.getElementById('chat-flow');
            const isMe = m.name === session.nick;
            const div = document.createElement('div');
            div.className = `msg ${isMe ? 'me' : ''}`;
            div.innerHTML = isMe ? m.text : `<b>${m.name}</b><br>${m.text}`;
            flow.appendChild(div);
            document.getElementById('sc-chat').scrollTop = flow.scrollHeight;
        });

        function doCreate() {
            const name = document.getElementById('room-name').value;
            if(!name) return;
            alert(`–£–∑–µ–ª ${name} —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –≤ –æ–±–ª–∞–∫–µ!`);
            go('chat', document.querySelector('.n-icon'));
        }

        function logout() {
            localStorage.clear();
            location.reload();
        }

        document.getElementById('m-field').onkeypress = (e) => { if(e.key === 'Enter') pushMsg(); };
    </script>
</body>
</html>
