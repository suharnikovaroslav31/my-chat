<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA GLASS FIXED</title>
    <style>
        :root { --accent: #00d2ff; --glass: rgba(255, 255, 255, 0.03); --border: rgba(255, 255, 255, 0.1); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            background: #05070a; color: white; font-family: 'Inter', sans-serif; 
            height: 100vh; overflow: hidden; display: flex; align-items: center; justify-content: center;
        }

        /* Живой фон */
        .bg { position: fixed; inset: 0; z-index: -1; background: radial-gradient(circle at 50% 50%, #0a0e17, #05070a); }
        .blob { position: absolute; width: 600px; height: 600px; background: rgba(0, 210, 255, 0.05); filter: blur(100px); animation: move 20s infinite alternate; }
        @keyframes move { from { transform: translate(-10%, -10%); } to { transform: translate(10%, 10%); } }

        /* ЭКРАН ВХОДА */
        #auth-screen {
            position: absolute; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            z-index: 9999; background: #05070a; /* Полностью закрывает чат */
        }
        .auth-card {
            background: rgba(15, 17, 26, 0.95); backdrop-filter: blur(40px);
            padding: 40px; border-radius: 24px; border: 1px solid var(--border);
            width: 350px; text-align: center; box-shadow: 0 40px 80px rgba(0,0,0,0.6);
        }
        .auth-card input {
            width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 12px;
            border: 1px solid var(--border); background: #000; color: #fff; outline: none;
        }
        #auth-btn {
            width: 100%; padding: 14px; background: var(--accent); border: none;
            border-radius: 12px; font-weight: 800; cursor: pointer; color: #000;
        }

        /* ГЛАВНЫЙ ЧАТ (СКРЫТ ПО УМОЛЧАНИЮ) */
        #main-app {
            display: none; /* Скрыт пока не войдешь */
            width: 98vw; height: 96vh; background: var(--glass);
            backdrop-filter: blur(40px); border-radius: 20px; border: 1px solid var(--border);
        }
        
        /* Сетка чата */
        .container { display: flex; width: 100%; height: 100%; }
        .sidebar { width: 260px; background: rgba(0,0,0,0.3); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .chat { flex: 1; display: flex; flex-direction: column; }
        
        .nav-item { padding: 15px 20px; cursor: pointer; color: #888; transition: 0.2s; }
        .nav-item.active { color: var(--accent); background: rgba(0, 210, 255, 0.1); font-weight: bold; }
        .nav-item:hover { color: #fff; background: rgba(255,255,255,0.05); }

        #messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .bubble { padding: 12px 18px; border-radius: 18px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); max-width: 70%; }
        .mine { align-self: flex-end; border-color: var(--accent); background: rgba(0, 210, 255, 0.05); }

        .footer { padding: 20px; }
        #chat-form { display: flex; gap: 10px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 15px; border: 1px solid var(--border); }
        #msg-input { flex: 1; background: none; border: none; color: #fff; outline: none; }
    </style>
</head>
<body>
    <div class="bg"><div class="blob"></div></div>

    <div id="auth-screen">
        <div class="auth-card">
            <h1 id="auth-title" style="margin-bottom: 20px;">ULTRA<span>PRO</span></h1>
            <input type="text" id="username" placeholder="Логин">
            <input type="password" id="password" placeholder="Пароль">
            <p id="error" style="color: red; font-size: 12px; margin-bottom: 10px;"></p>
            <button onclick="auth()" id="auth-btn">ВОЙТИ</button>
            <p style="margin-top: 15px; font-size: 12px; cursor: pointer; opacity: 0.6;" onclick="swap()">Создать аккаунт</p>
        </div>
    </div>

    <div id="main-app">
        <div class="container">
            <aside class="sidebar">
                <div style="padding: 25px; font-weight: 900; color: var(--accent);">CHANNELS</div>
                <div id="rooms">
                    <div class="nav-item active" onclick="chRoom('основной-чат', this)"># основной-чат</div>
                    <div class="nav-item" onclick="chRoom('флудилка', this)"># флудилка</div>
                    <div class="nav-item" onclick="chRoom('новости', this)"># новости</div>
                </div>
                <div style="margin-top: auto; padding: 20px; border-top: 1px solid var(--border);" id="my-name">User</div>
            </aside>
            <main class="chat">
                <div id="messages"></div>
                <div class="footer">
                    <form id="chat-form">
                        <input type="text" id="msg-input" placeholder="Введите сообщение..." autocomplete="off">
                        <button type="submit" style="background:var(--accent); border:none; padding:8px 15px; border-radius:10px; cursor:pointer;">➤</button>
                    </form>
                </div>
            </main>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let isReg = false;
        let room = 'основной-чат';

        function swap() {
            isReg = !isReg;
            document.getElementById('auth-title').innerText = isReg ? 'РЕГИСТРАЦИЯ' : 'ULTRA PRO';
            document.getElementById('auth-btn').innerText = isReg ? 'СОЗДАТЬ' : 'ВОЙТИ';
        }

        function auth() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            if(u && p) socket.emit('authenticate', { username: u, password: p, isRegister: isReg });
        }

        function chRoom(n, el) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            room = n;
            document.getElementById('messages').innerHTML = '';
            socket.emit('join_room', n);
        }

        socket.on('auth_error', m => document.getElementById('error').innerText = m);
        socket.on('auth_success', d => {
            window.me = d.username;
            document.getElementById('auth-screen').style.setProperty('display', 'none', 'important');
            document.getElementById('main-app').style.display = 'block';
            document.getElementById('my-name').innerText = d.username;
            socket.emit('join_room', room);
        });

        socket.on('message', m => render(m));
        socket.on('load_history', h => {
            document.getElementById('messages').innerHTML = '';
            h.forEach(render);
        });

        function render(m) {
            const d = document.createElement('div');
            d.className = `bubble ${m.name === window.me ? 'mine' : ''}`;
            d.innerHTML = `<small style="color:var(--accent)">${m.name}</small><br>${m.text}`;
            document.getElementById('messages').appendChild(d);
            document.getElementById('messages').scrollTop = 99999;
        }

        document.getElementById('chat-form').onsubmit = (e) => {
            e.preventDefault();
            const i = document.getElementById('msg-input');
            if(i.value) {
                socket.emit('message', { name: window.me, text: i.value });
                i.value = '';
            }
        };
    </script>
</body>
</html>
