<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Speeky | Core Engine</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #00f2ff;
            --bg: #050608;
            --card: #11131a;
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* –≠–ö–†–ê–ù–´ */
        .screen { display: none; flex: 1; flex-direction: column; padding: 20px; padding-bottom: 160px; overflow-y: auto; }
        .screen.active { display: flex; }

        /* –®–ê–ü–ö–ò */
        .screen-header { margin-bottom: 25px; }
        .screen-header h1 { font-size: 32px; font-weight: 800; }
        .screen-header p { opacity: 0.5; font-size: 14px; margin-top: 5px; }

        /* –ö–ê–†–¢–û–ß–ö–ò –ò –§–û–†–ú–´ */
        .ui-card { background: var(--card); border: 1px solid var(--border); border-radius: 25px; padding: 20px; margin-bottom: 15px; }
        .ui-input { width: 100%; background: #1a1d26; border: 1px solid var(--border); padding: 15px; border-radius: 15px; color: #fff; margin: 10px 0; outline: none; }
        .ui-btn { width: 100%; padding: 15px; border-radius: 15px; border: none; font-weight: 800; cursor: pointer; background: var(--accent); color: #000; }
        .ui-btn.secondary { background: rgba(255,255,255,0.05); color: #fff; margin-top: 10px; }

        /* –ß–ê–¢ –°–ü–ï–¶–ò–§–ò–ö–ê */
        #chat-scroller { display: flex; flex-direction: column; gap: 15px; }
        .msg { max-width: 85%; padding: 12px 16px; border-radius: 20px; background: var(--card); border: 1px solid var(--border); align-self: flex-start; }
        .msg.me { align-self: flex-end; background: var(--accent); color: #000; font-weight: 600; }

        /* –û–°–¢–†–û–í–û–ö –ò –í–í–û–î */
        .bottom-nav-area { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 450px; z-index: 1000; display: flex; flex-direction: column; gap: 12px; }
        .input-wrap { background: rgba(15,17,23,0.9); backdrop-filter: blur(20px); border-radius: 25px; border: 1px solid var(--border); padding: 8px 15px; display: none; align-items: center; }
        .input-wrap.visible { display: flex; }
        .input-wrap input { flex: 1; background: none; border: none; color: #fff; padding: 10px; outline: none; }

        .island { background: rgba(15,17,23,0.95); backdrop-filter: blur(25px); border-radius: 35px; border: 1px solid var(--border); display: flex; justify-content: space-around; padding: 12px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .nav-icon { font-size: 24px; cursor: pointer; opacity: 0.3; transition: 0.3s; }
        .nav-icon.active { opacity: 1; color: var(--accent); transform: scale(1.1); }

        /* –ê–í–ê–¢–ê–† */
        .profile-pic { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(45deg, var(--accent), #9d50ff); margin-bottom: 15px; display: flex; align-items: center; justify-content: center; font-size: 30px; font-weight: 800; }

        /* –ê–ù–ò–ú–ê–¶–ò–Ø –í–•–û–î–ê */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: flex; align-items: center; justify-content: center; padding: 20px; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div style="width: 100%; max-width: 320px; text-align: center;">
            <h1 style="font-size: 40px; margin-bottom: 10px;">Speeky</h1>
            <p style="opacity:0.5; margin-bottom:30px;">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –æ–±–ª–∞–∫–æ</p>
            <input type="email" id="auth-email" class="ui-input" placeholder="Email">
            <input type="text" id="auth-nick" class="ui-input" placeholder="Nickname">
            <button class="ui-btn" onclick="startApp()">–í–û–ô–¢–ò –í –°–ò–°–¢–ï–ú–£</button>
        </div>
    </div>

    <section id="screen-chat" class="screen active">
        <div class="screen-header">
            <h1>–û–±—â–µ–Ω–∏–µ</h1>
            <p>–í—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É —É–∑–ª—É</p>
        </div>
        <div id="chat-scroller">
            <div class="msg">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Speeky! –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –≤–∞—à—É –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î.</div>
        </div>
    </section>

    <section id="screen-contacts" class="screen">
        <div class="screen-header">
            <h1>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h1>
            <p>–õ—é–¥–∏, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –≤—ã –Ω–∞ —Å–≤—è–∑–∏</p>
        </div>
        <div class="ui-card">
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="width:40px; height:40px; border-radius:50%; background:var(--accent);"></div>
                <div><b>–Ø—Ä–æ—Å–ª–∞–≤ (–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫)</b><br><small style="color:#0f8;">Online</small></div>
            </div>
        </div>
        <div id="custom-contacts-list"></div>
    </section>

    <section id="screen-create" class="screen">
        <div class="screen-header">
            <h1>–°–æ–∑–¥–∞—Ç—å</h1>
            <p>–ù–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –æ–±—â–µ–Ω–∏—è</p>
        </div>
        <div class="ui-card">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã/–∫–∞–Ω–∞–ª–∞</label>
            <input type="text" id="new-room-name" class="ui-input" placeholder="–ù–∞–ø—Ä: –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏">
            <label>–¢–∏–ø –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞</label>
            <select class="ui-input" id="new-room-type">
                <option value="group">–ü—É–±–ª–∏—á–Ω–∞—è –≥—Ä—É–ø–ø–∞</option>
                <option value="channel">–ö–∞–Ω–∞–ª (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)</option>
                <option value="private">–ü—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç</option>
            </select>
            <button class="ui-btn" onclick="createNewRoom()">–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –°–û–ó–î–ê–ù–ò–ï</button>
        </div>
    </section>

    <section id="screen-settings" class="screen">
        <div class="screen-header">
            <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–∏–º —Ü–∏—Ñ—Ä–æ–≤—ã–º —Å–ª–µ–¥–æ–º</p>
        </div>
        <div class="ui-card" style="display:flex; flex-direction:column; align-items:center;">
            <div class="profile-pic" id="avatar-preview">?</div>
            <h2 id="display-nick">User</h2>
            <p id="display-email" style="opacity:0.5; font-size:12px;">user@example.com</p>
        </div>
        <div class="ui-card">
            <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
            <input type="text" id="edit-nick" class="ui-input" placeholder="–ù–æ–≤—ã–π –Ω–∏–∫">
            <button class="ui-btn secondary" onclick="updateProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </div>
        <div class="ui-card">
            <h3>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
            <div style="display:flex; justify-content:space-between; margin:10px 0;">
                <span>E2E –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</span>
                <input type="checkbox" checked>
            </div>
            <button class="ui-btn secondary" style="color:#ff4444;" onclick="resetAll()">–í—ã–π—Ç–∏ –∏ —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        </div>
    </section>

    <div class="bottom-nav-area">
        <div class="input-wrap visible" id="chat-input-zone">
            <input type="text" id="m-text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
            <button onclick="sendMsg()" style="background:var(--accent); border:none; width:35px; height:35px; border-radius:50%; font-weight:900;">></button>
        </div>

        <div class="island">
            <div class="nav-icon active" onclick="nav('chat', this)">üí¨</div>
            <div class="nav-icon" onclick="nav('contacts', this)">üë§</div>
            <div class="nav-icon" onclick="nav('create', this)">‚äï</div>
            <div class="nav-icon" onclick="nav('settings', this)">‚öôÔ∏è</div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let userData = JSON.parse(localStorage.getItem('speeky_user'));

        if(userData) loadApp();

        function startApp() {
            const email = document.getElementById('auth-email').value;
            const nick = document.getElementById('auth-nick').value;
            if(!email || !nick) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è!");

            userData = { email, nick, id: Date.now() };
            localStorage.setItem('speeky_user', JSON.stringify(userData));
            loadApp();
        }

        function loadApp() {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('display-nick').innerText = userData.nick;
            document.getElementById('display-email').innerText = userData.email;
            document.getElementById('avatar-preview').innerText = userData.nick[0].toUpperCase();
            socket.emit('authenticate', { username: userData.nick });
        }

        // –ù–ê–í–ò–ì–ê–¶–ò–Ø (–†–ê–ë–û–ß–ê–Ø)
        function nav(screenId, el) {
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω—ã
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-' + screenId).classList.add('active');

            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∏–∫–æ–Ω–∫–∏
            document.querySelectorAll('.nav-icon').forEach(i => i.classList.remove('active'));
            el.classList.add('active');

            // –°–∫—Ä—ã–≤–∞–µ–º –≤–≤–æ–¥ –µ—Å–ª–∏ –Ω–µ –≤ —á–∞—Ç–µ
            const inputZone = document.getElementById('chat-input-zone');
            if(screenId === 'chat') inputZone.classList.add('visible');
            else inputZone.classList.remove('visible');
        }

        // –§–£–ù–ö–¶–ò–ò –ò–ù–¢–ï–†–§–ï–ô–°–ê
        function createNewRoom() {
            const name = document.getElementById('new-room-name').value;
            if(!name) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ!");
            alert(`–£—Å–ø–µ—à–Ω–æ! –ì—Ä—É–ø–ø–∞ "${name}" —Å–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –ë–î.`);
            nav('chat', document.querySelector('.nav-icon')); // –í–æ–∑–≤—Ä–∞—Ç –≤ —á–∞—Ç
        }

        function updateProfile() {
            const newNick = document.getElementById('edit-nick').value;
            if(!newNick) return;
            userData.nick = newNick;
            localStorage.setItem('speeky_user', JSON.stringify(userData));
            location.reload();
        }

        function resetAll() {
            if(confirm("–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?")) {
                localStorage.clear();
                location.reload();
            }
        }

        // –ß–ê–¢
        function sendMsg() {
            const input = document.getElementById('m-text');
            if(input.value.trim()) {
                socket.emit('message', { text: input.value, name: userData.nick });
                input.value = '';
            }
        }

        socket.on('message', m => {
            const box = document.getElementById('chat-scroller');
            const isMe = m.name === userData.nick;
            const div = document.createElement('div');
            div.className = `msg ${isMe ? 'me' : ''}`;
            div.innerHTML = isMe ? m.text : `<b>${m.name}</b><br>${m.text}`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });

        document.getElementById('m-text').onkeypress = (e) => { if(e.key === 'Enter') sendMsg(); };
    </script>
</body>
</html>
