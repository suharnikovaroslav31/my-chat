<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ULTRA CORE | OFFICIAL</title>
    <style>
        :root {
            --accent: #00d2ff;
            --bg: #0e1621;
            --side: #17212b;
            --panel: #242f3d;
            --msg-in: #182533;
            --msg-out: #2b5278;
            --anim-speed: 0.3s; /* Управляется настройками */
        }

        /* Настройки через классы */
        body.no-anim * { transition: none !important; animation: none !important; }
        body.glass-theme { --bg: #050505; --side: rgba(23, 33, 43, 0.8); }
        body.glass-theme .sidebar { backdrop-filter: blur(20px); }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: #fff; height: 100vh; display: flex; overflow: hidden; }

        /* ЭКРАН РЕГИСТРАЦИИ */
        #auth-screen { position: fixed; inset: 0; background: #0e1621; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .auth-card { width: 350px; text-align: center; }
        .tg-input { width: 100%; padding: 12px; background: none; border: none; border-bottom: 2px solid var(--accent); color: #fff; margin-bottom: 20px; outline: none; font-size: 18px; }
        .tg-btn { width: 100%; padding: 15px; background: var(--accent); border: none; border-radius: 10px; color: #000; font-weight: 700; cursor: pointer; }

        /* ОСНОВНОЙ ИНТЕРФЕЙС */
        .sidebar { width: 320px; background: var(--side); border-right: 1px solid rgba(0,0,0,0.3); display: flex; flex-direction: column; }
        .chat-area { flex: 1; display: flex; flex-direction: column; position: relative; }
        
        .header { height: 60px; background: var(--side); display: flex; align-items: center; padding: 0 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 10; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; background: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded17.png'); }

        .bubble { max-width: 75%; padding: 10px 15px; border-radius: 15px; font-size: 14px; line-height: 1.4; position: relative; animation: pop var(--anim-speed) ease; }
        @keyframes pop { from { opacity: 0; transform: scale(0.9); } }
        .bubble.in { align-self: flex-start; background: var(--msg-in); border-bottom-left-radius: 2px; }
        .bubble.out { align-self: flex-end; background: var(--msg-out); border-bottom-right-radius: 2px; }
        .bubble .time { font-size: 10px; opacity: 0.5; float: right; margin: 5px 0 0 10px; }

        .input-box { padding: 15px 25px; background: var(--side); display: flex; gap: 15px; }
        #m-input { flex: 1; background: none; border: none; color: #fff; outline: none; font-size: 16px; }

        /* ПАНЕЛЬ НАСТРОЕК */
        #settings { position: fixed; left: -320px; top: 0; bottom: 0; width: 310px; background: var(--side); z-index: 1000; transition: var(--anim-speed); padding: 30px 20px; box-shadow: 10px 0 30px rgba(0,0,0,0.5); }
        #settings.open { left: 0; }
        .set-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        
        .toggle { width: 40px; height: 20px; background: #333; border-radius: 10px; position: relative; }
        .toggle.on { background: var(--accent); }
        .toggle::after { content: ''; position: absolute; width: 16px; height: 16px; background: #fff; border-radius: 50%; top: 2px; left: 2px; transition: 0.2s; }
        .toggle.on::after { left: 22px; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-card">
            <h1 style="margin-bottom: 40px;">ВХОД В СИСТЕМУ</h1>
            <input type="text" id="username" class="tg-input" placeholder="Ваше имя...">
            <button class="tg-btn" onclick="auth()">ВОЙТИ</button>
        </div>
    </div>

    <div id="settings">
        <div style="text-align: center; margin-bottom: 30px;">
            <div id="my-ava" style="width: 80px; height: 80px; background: var(--accent); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 30px; color: #000; font-weight: 900;">U</div>
            <h2 id="my-name">User</h2>
            <p id="my-id-label" style="font-size: 12px; opacity: 0.5;">ID: ---</p>
        </div>

        <div class="set-item" onclick="toggleOption('glass')">
            <span>Glass Mode</span>
            <div class="toggle" id="sw-glass"></div>
        </div>
        <div class="set-item" onclick="toggleOption('anim')">
            <span>Анимации</span>
            <div class="toggle on" id="sw-anim"></div>
        </div>
        <div class="set-item" style="color: #ff4444;" onclick="location.reload()">
            <span>Выйти</span>
        </div>
        <button class="tg-btn" style="margin-top: 50px;" onclick="closeSets()">ЗАКРЫТЬ</button>
    </div>

    <aside class="sidebar">
        <div style="padding: 20px; font-weight: 700; display: flex; justify-content: space-between;">
            <span onclick="openSets()" style="cursor: pointer;">☰ МЕНЮ</span>
        </div>
        <div style="background: var(--panel); margin: 10px; padding: 15px; border-radius: 10px; cursor: pointer;">
            <b># основной-чат</b>
            <div style="font-size: 12px; color: var(--accent);">В сети: <span id="online-count">1</span></div>
        </div>
    </aside>

    <main class="chat-area">
        <header class="header">
            <h3 id="chat-title"># основной-чат</h3>
        </header>
        <div id="messages"></div>
        <form class="input-box" id="chat-form">
            <input type="text" id="m-input" placeholder="Написать сообщение..." autocomplete="off">
            <button type="submit" style="background:none; border:none; color:var(--accent); font-weight:700; cursor:pointer;">ОТПРАВИТЬ</button>
        </form>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let me = null;

        function auth() {
            const u = document.getElementById('username').value;
            if(!u) return;
            socket.emit('authenticate', { username: u });
        }

        socket.on('auth_success', data => {
            me = data;
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('my-name').innerText = me.username;
            document.getElementById('my-ava').innerText = me.username[0].toUpperCase();
            document.getElementById('my-id-label').innerText = "ID: " + me.id;
        });

        socket.on('update_online', count => {
            document.getElementById('online-count').innerText = count;
        });

        const form = document.getElementById('chat-form');
        form.onsubmit = (e) => {
            e.preventDefault();
            const input = document.getElementById('m-input');
            if(input.value) {
                socket.emit('message', { text: input.value });
                input.value = '';
            }
        };

        socket.on('message', m => {
            const wrap = document.getElementById('messages');
            const isMe = m.name === me.username;
            const div = document.createElement('div');
            div.className = `bubble ${isMe ? 'out' : 'in'}`;
            div.innerHTML = `
                ${!isMe ? `<b style="color:var(--accent); font-size:12px;">${m.name}</b><br>` : ''}
                ${m.text}
                <span class="time">${m.time}</span>
            `;
            wrap.appendChild(div);
            wrap.scrollTop = wrap.scrollHeight;
        });

        // ЛОГИКА НАСТРОЕК
        function openSets() { document.getElementById('settings').classList.add('open'); }
        function closeSets() { document.getElementById('settings').classList.remove('open'); }

        const state = { glass: false, anim: true };
        function toggleOption(opt) {
            state[opt] = !state[opt];
            document.getElementById('sw-' + opt).classList.toggle('on');
            
            if(opt === 'glass') document.body.classList.toggle('glass-theme');
            if(opt === 'anim') document.body.classList.toggle('no-anim');
        }
    </script>
</body>
</html>
