<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA CORE | V5 PRO</title>
    <style>
        :root {
            --accent: #00d2ff;
            --accent-soft: rgba(0, 210, 255, 0.15);
            --bg: #010204;
            --panel: rgba(10, 15, 25, 0.8);
            --border: rgba(255, 255, 255, 0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; transition: all 0.2s ease; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; }

        /* –ñ–∏–≤–æ–π —Ñ–æ–Ω (–≥–ª—É–±–æ–∫–∏–π –∫–æ—Å–º–æ—Å) */
        .space-bg { position: fixed; inset: 0; z-index: -1; background: radial-gradient(circle at 30% 30%, #0d1a2a 0%, #010204 100%); }
        .stars { position: absolute; inset: 0; background: url('https://www.transparenttextures.com/patterns/stardust.png'); opacity: 0.15; animation: slowDrift 80s linear infinite; }
        @keyframes slowDrift { from { background-position: 0 0; } to { background-position: 1000px 1000px; } }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen { position: fixed; inset: 0; z-index: 1000; background: var(--bg); display: flex; align-items: center; justify-content: center; }
        .hidden { opacity: 0; pointer-events: none; transform: scale(1.05); filter: blur(20px); }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ */
        .auth-card { background: var(--panel); backdrop-filter: blur(40px); padding: 50px; border-radius: 40px; border: 1px solid var(--border); width: 400px; text-align: center; }
        input { width: 100%; padding: 18px; margin-bottom: 15px; border-radius: 16px; border: 1px solid var(--border); background: rgba(0,0,0,0.5); color: #fff; outline: none; }
        input:focus { border-color: var(--accent); box-shadow: 0 0 20px var(--accent-soft); }
        .btn-main { width: 100%; padding: 18px; background: var(--accent); color: #000; border: none; border-radius: 16px; font-weight: 900; cursor: pointer; }

        /* –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        #app { display: grid; grid-template-columns: 80px 320px 1fr; width: 100vw; height: 100vh; }

        .rail { background: rgba(0,0,0,0.6); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 30px 0; gap: 20px; }
        .r-icon { width: 54px; height: 54px; border-radius: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 22px; }
        .r-icon:hover { background: var(--accent-soft); color: var(--accent); }
        .r-icon.active { background: var(--accent); color: #000; box-shadow: 0 0 30px var(--accent-soft); }

        .sidebar { background: rgba(5, 10, 20, 0.4); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .c-item { padding: 18px 25px; margin: 5px 15px; border-radius: 20px; display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .c-item.active { background: var(--accent-soft); border: 1px solid rgba(0,210,255,0.1); }

        .viewport { display: flex; flex-direction: column; position: relative; }
        .v-header { height: 85px; border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 40px; justify-content: space-between; backdrop-filter: blur(15px); }
        
        #messages { flex: 1; overflow-y: auto; padding: 40px; display: flex; flex-direction: column; gap: 20px; }
        .bubble { padding: 16px 22px; border-radius: 24px; background: var(--panel); border: 1px solid var(--border); max-width: 65%; animation: msgIn 0.3s ease-out; }
        .bubble.me { align-self: flex-end; background: rgba(0,210,255,0.08); border-color: rgba(0,210,255,0.2); }
        @keyframes msgIn { from { opacity: 0; transform: translateY(15px); } }

        .v-input { padding: 30px 50px; }
        .i-wrap { background: rgba(255,255,255,0.04); border: 1px solid var(--border); border-radius: 25px; padding: 12px 30px; display: flex; align-items: center; gap: 20px; }
        #msg-field { flex: 1; background: none; border: none; color: #fff; outline: none; font-size: 16px; }

        /* –ì–ò–ì–ê–ù–¢–°–ö–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò (Side Panel) */
        #settings-panel {
            position: fixed; right: -450px; top: 0; bottom: 0; width: 420px; 
            background: #080c14; z-index: 2000; border-left: 1px solid var(--border);
            padding: 40px; overflow-y: auto; transition: 0.6s cubic-bezier(0.85, 0, 0.15, 1);
        }
        #settings-panel.open { right: 0; box-shadow: -50px 0 100px rgba(0,0,0,0.8); }

        .set-section { margin-bottom: 35px; }
        .set-section h4 { font-size: 12px; color: var(--accent); letter-spacing: 2px; margin-bottom: 20px; text-transform: uppercase; }
        .set-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--border); font-size: 14px; }
        .toggle { width: 40px; height: 20px; background: #333; border-radius: 20px; position: relative; cursor: pointer; }
        .toggle.on { background: var(--accent); }
        .toggle::after { content: ''; position: absolute; width: 16px; height: 16px; background: #fff; border-radius: 50%; top: 2px; left: 2px; transition: 0.3s; }
        .toggle.on::after { left: 22px; }
    </style>
</head>
<body>

    <div class="space-bg"><div class="stars"></div></div>

    <div id="screen-auth" class="screen">
        <div class="auth-card">
            <h2 style="margin-bottom: 30px; letter-spacing: 5px;">ULTRA CORE</h2>
            <input type="text" id="in-name" placeholder="–õ–æ–≥–∏–Ω">
            <input type="password" id="in-pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn-main" onclick="startSession()">–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø</button>
        </div>
    </div>

    <div id="app" class="hidden">
        <nav class="rail">
            <div class="r-icon active">üí¨</div>
            <div class="r-icon" onclick="openSettings()">‚öôÔ∏è</div>
            <div class="r-icon" style="margin-top: auto;">üîí</div>
        </nav>

        <aside class="sidebar">
            <div style="padding: 30px 25px; font-weight: 900; font-size: 12px; letter-spacing: 2px; opacity: 0.5;">–°–ï–ö–¢–û–†–´ –ß–ê–¢–ê</div>
            <div class="c-item active">
                <div style="width: 45px; height: 45px; background: var(--accent); border-radius: 15px; color:#000; display:flex; align-items:center; justify-content:center; font-weight:900;">#</div>
                <div>
                    <div style="font-weight: 700;">–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫</div>
                    <div style="font-size: 11px; opacity: 0.4;">–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø</div>
                </div>
            </div>
        </aside>

        <main class="viewport">
            <header class="v-header">
                <div>
                    <h3 id="current-chat-name"># –æ—Å–Ω–æ–≤–Ω–æ–π-–ø–æ—Ç–æ–∫</h3>
                    <p style="font-size: 12px; color: #00ff88;">‚óè <span id="counter">0</span> –∞–∫—Ç–∏–≤–Ω—ã—Ö —É–∑–ª–æ–≤</p>
                </div>
                <div style="font-size: 11px; padding: 6px 12px; background: var(--accent-soft); border-radius: 8px; color: var(--accent);">V5.0 STABLE</div>
            </header>

            <div id="messages"></div>

            <div class="v-input">
                <form id="send-form" class="i-wrap">
                    <input type="text" id="msg-field" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–∏–≥–Ω–∞–ª –≤ —Å–∏—Å—Ç–µ–º—É..." autocomplete="off">
                    <button type="submit" style="background:none; border:none; color:var(--accent); font-weight:900; cursor:pointer;">–ü–ï–†–ï–î–ê–¢–¨</button>
                </form>
            </div>
        </main>
    </div>

    <div id="settings-panel">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <button onclick="openSettings()" style="background:none; border:none; color:#ff4444; cursor:pointer;">–ó–ê–ö–†–´–¢–¨</button>
        </div>

        <div class="set-section">
            <h4>–ê–∫–∫–∞—É–Ω—Ç</h4>
            <div style="display: flex; gap: 20px; align-items: center; margin-bottom: 20px;">
                <div style="width: 70px; height: 70px; background: var(--accent); border-radius: 25px;"></div>
                <div>
                    <h3 id="set-username">User</h3>
                    <p style="font-size: 12px; opacity: 0.5;">ID: <span id="my-id">---</span></p>
                </div>
            </div>
            <input type="text" placeholder="–ò–∑–º–µ–Ω–∏—Ç—å –±–∏–æ..." style="padding: 12px; font-size: 13px;">
        </div>

        <div class="set-section">
            <h4>–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è</h4>
            <div class="set-row">
                <span>–ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω</span>
                <div class="toggle on" onclick="this.classList.toggle('on')"></div>
            </div>
            <div class="set-row">
                <span>–≠—Ñ—Ñ–µ–∫—Ç—ã —Ä–∞–∑–º—ã—Ç–∏—è</span>
                <div class="toggle on" onclick="this.classList.toggle('on')"></div>
            </div>
            <div class="set-row">
                <span>–ó–≤—É–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</span>
                <div class="toggle" onclick="this.classList.toggle('on')"></div>
            </div>
        </div>

        <div class="set-section">
            <h4>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–∞–Ω–Ω—ã–µ</h4>
            <div class="set-row" style="cursor: pointer; color: #00d2ff;">–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–µ—Å—Å–∏–π</div>
            <div class="set-row" style="cursor: pointer; color: #ff4444;">–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π</div>
            <div class="set-row" style="cursor: pointer; color: #ff4444;" onclick="location.reload()">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myName = "";

        function startSession() {
            const val = document.getElementById('in-name').value;
            if(!val) return;
            myName = val;
            socket.emit('authenticate', { username: val, password: '123', isRegister: true });
        }

        socket.on('auth_success', data => {
            document.getElementById('screen-auth').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('set-username').innerText = myName;
            document.getElementById('my-id').innerText = socket.id || "GEN-CORE-1";
            socket.emit('join_room', 'main');
        });

        // --- –§–ò–ö–° –°–ß–ï–¢–ß–ò–ö–ê ---
        // –°–ª—É—à–∞–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–æ–±—ã—Ç–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        function updateCounter(num) {
            document.getElementById('counter').innerText = num;
        }

        socket.on('room_users', (data) => {
            // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —à–ª–µ—Ç –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
            const count = typeof data === 'object' ? Object.keys(data).length : data;
            updateCounter(count);
        });

        socket.on('update_online', (count) => {
            updateCounter(count);
        });

        // --- –õ–û–ì–ò–ö–ê –ß–ê–¢–ê ---
        const form = document.getElementById('send-form');
        form.onsubmit = (e) => {
            e.preventDefault();
            const inp = document.getElementById('msg-field');
            if(inp.value.trim()) {
                socket.emit('message', { text: inp.value });
                inp.value = '';
            }
        };

        socket.on('message', m => {
            const container = document.getElementById('messages');
            const div = document.createElement('div');
            const isMe = m.name === myName;
            div.className = `bubble ${isMe ? 'me' : ''}`;
            div.innerHTML = `<small style="color:var(--accent); font-weight:800; font-size:10px; display:block; margin-bottom:5px;">${m.name}</small>${m.text}`;
            container.appendChild(div);
            container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
        });

        function openSettings() {
            document.getElementById('settings-panel').classList.toggle('open');
        }
    </script>
</body>
</html>
