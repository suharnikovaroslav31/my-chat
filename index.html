<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Speeky OS | Ultra Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #00f2ff;
            --bg: #030406;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --card: rgba(15, 17, 23, 0.85);
            --radius: 35px;
            --blur: 25px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; position: relative; transition: background 0.5s; }

        /* –≠–§–§–ï–ö–¢–´ –§–û–ù–ê */
        .ambient-bg { position: fixed; inset: 0; z-index: -1; overflow: hidden; }
        .blob { position: absolute; width: 600px; height: 600px; background: var(--accent); filter: blur(140px); opacity: 0.1; border-radius: 50%; animation: move 20s infinite alternate; }
        @keyframes move { from { transform: translate(-15%, -15%); } to { transform: translate(35%, 35%); } }

        /* –ò–ù–¢–†–û (WELCOME) */
        #welcome-overlay {
            position: fixed; inset: 0; z-index: 9999; background: var(--bg);
            display: none; align-items: center; justify-content: center; transition: 1s ease;
        }
        .welcome-content { text-align: center; animation: zoomFade 1.5s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes zoomFade { 
            0% { opacity: 0; transform: scale(0.9); filter: blur(10px); }
            100% { opacity: 1; transform: scale(1); filter: blur(0); }
        }

        /* –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø */
        #auth-layer { position: fixed; inset: 0; z-index: 5000; background: var(--bg); display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { width: 100%; max-width: 400px; padding: 40px; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); backdrop-filter: blur(var(--blur)); }

        /* MAIN APP */
        #app { display: none; height: 100vh; flex-direction: column; opacity: 0; transition: 1s; }
        .screen { display: none; flex: 1; padding: 25px; padding-bottom: 200px; overflow-y: auto; scroll-behavior: smooth; }
        .screen.active { display: flex; flex-direction: column; animation: screenIn 0.6s ease forwards; }
        @keyframes screenIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* –ü–†–û–§–ò–õ–¨ (–ö–ê–†–¢–û–ß–ö–ê –ò–ó –°–ö–†–ò–ù–®–û–¢–û–í) */
        .profile-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 100%);
            border: 1px solid var(--border); border-radius: var(--radius);
            padding: 30px; position: relative; overflow: hidden; margin-top: 15px;
        }
        .profile-card::before { content: ''; position: absolute; top: -50%; right: -20%; width: 200px; height: 200px; background: var(--accent); filter: blur(80px); opacity: 0.15; }
        
        .p-info { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; }
        .p-avatar-wrap { position: relative; width: 85px; height: 85px; }
        .p-avatar { width: 100%; height: 100%; border-radius: 50%; background: var(--accent); color: #000; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 800; box-shadow: 0 0 25px var(--accent-soft); }
        .status-dot { position: absolute; bottom: 5px; right: 5px; width: 18px; height: 18px; background: #0f8; border: 3px solid #0f1117; border-radius: 50%; }

        /* –ù–ê–°–¢–†–û–ô–ö–ò (–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –†–ê–°–®–ò–†–ï–ù–ù–´–ï) */
        .setting-group { margin-top: 25px; }
        .setting-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; opacity: 0.4; margin-bottom: 12px; display: block; }
        .setting-item { 
            background: var(--glass); border: 1px solid var(--border); padding: 18px; 
            border-radius: 20px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;
        }
        select, input[type="range"] { background: none; border: none; color: var(--accent); font-weight: 600; outline: none; }

        /* –û–°–¢–†–û–í–û–ö –ù–ê–í–ò–ì–ê–¶–ò–ò */
        .island-controller { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 440px; z-index: 1000; }
        .island-nav { background: rgba(10, 12, 18, 0.95); backdrop-filter: blur(40px); border: 1px solid var(--border); border-radius: 50px; padding: 10px; display: flex; justify-content: space-around; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .nav-link { font-size: 24px; opacity: 0.2; cursor: pointer; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); padding: 12px; }
        .nav-link.active { opacity: 1; color: var(--accent); transform: scale(1.2) translateY(-5px); }

        /* –ö–ù–û–ü–ö–ò –ò –ò–ù–ü–£–¢–´ */
        input[type="text"], input[type="email"], input[type="password"] { width: 100%; background: rgba(255,255,255,0.04); border: 1px solid var(--border); padding: 16px 20px; border-radius: 18px; color: #fff; margin-bottom: 12px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--accent); background: rgba(255,255,255,0.07); }
        .btn-prime { width: 100%; padding: 18px; border-radius: 20px; border: none; background: var(--accent); color: #000; font-weight: 800; cursor: pointer; transition: 0.3s; }
        .btn-prime:active { transform: scale(0.96); }

        .editable-bio { opacity: 0.6; font-size: 14px; border: none; background: none; color: #fff; width: 100%; padding: 5px 0; outline: none; border-bottom: 1px transparent solid; transition: 0.3s; }
        .editable-bio:focus { border-bottom-color: var(--accent); opacity: 1; }
    </style>
</head>
<body>

    <div class="ambient-bg"><div class="blob"></div></div>

    <div id="welcome-overlay">
        <div class="welcome-content">
            <h1 id="intro-name" style="font-size: 48px; font-weight: 800; margin-bottom: 10px;">Speeky</h1>
            <p id="intro-status" style="opacity: 0.5; letter-spacing: 2px;">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–π—Ä–æ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞...</p>
        </div>
    </div>

    <div id="auth-layer">
        <div class="auth-card">
            <div id="auth-login" class="auth-form active">
                <h1 style="margin-bottom: 10px; font-size: 32px;">–í—Ö–æ–¥</h1>
                <input type="email" id="l-email" placeholder="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞">
                <input type="password" id="l-pass" placeholder="–ü–∞—Ä–æ–ª—å">
                <button class="btn-prime" onclick="handleLogin()">–ê–í–¢–û–†–ò–ó–û–í–ê–¢–¨–°–Ø</button>
                <p onclick="toggleForm('auth-reg')" style="text-align:center; margin-top:20px; cursor:pointer; color:var(--accent); font-size:13px; font-weight:600;">–°–æ–∑–¥–∞—Ç—å Speeky ID</p>
            </div>
            <div id="auth-reg" class="auth-form">
                <h1 style="margin-bottom: 10px;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
                <input type="text" id="r-nick" placeholder="–ù–∏–∫–Ω–µ–π–º">
                <input type="email" id="r-email" placeholder="Email">
                <input type="password" id="r-pass" placeholder="–ü–∞—Ä–æ–ª—å">
                <input type="text" id="r-secret" placeholder="–°–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–ª–æ–≤–æ">
                <button class="btn-prime" onclick="handleRegister()">–°–û–ó–î–ê–¢–¨ –ê–ö–ö–ê–£–ù–¢</button>
                <p onclick="toggleForm('auth-login')" style="text-align:center; margin-top:20px; cursor:pointer; font-size:13px;">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç</p>
            </div>
        </div>
    </div>

    <div id="app">
        <section id="sc-chat" class="screen active">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <h1 style="font-size: 36px; font-weight: 800;">Speeky</h1>
                <div style="background:var(--accent-soft); padding:8px 15px; border-radius:20px; color:var(--accent); font-size:12px; font-weight:800;">ONLINE</div>
            </div>
            <div id="chat-flow">
                <div class="profile-card" style="margin-bottom:20px; padding:20px;">
                    <p style="font-size:14px; line-height:1.6;"><b>–≠—Ç–æ –°–ø–∏–∫–∏</b> ‚Äî —Ç–≤–æ—ë –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –æ–±—â–µ–Ω–∏—è. –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –¥–µ–ª–∏—Ç—å—Å—è –º–æ–º–µ–Ω—Ç–∞–º–∏ –∏ –±—ã—Ç—å —Å–æ–±–æ–π.</p>
                </div>
            </div>
        </section>

        <section id="sc-profile" class="screen">
            <h1 style="margin-bottom:10px;">–ú–æ–π ID</h1>
            <div class="profile-card">
                <div class="p-info">
                    <div class="p-avatar-wrap">
                        <div class="p-avatar" id="u-avatar">?</div>
                        <div class="status-dot"></div>
                    </div>
                    <div>
                        <h2 id="u-nick" style="font-size:24px;">Username</h2>
                        <input type="text" id="u-bio" class="editable-bio" placeholder="–î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ..." onblur="updateProfile()">
                    </div>
                </div>
                <div style="display:flex; gap:10px;">
                    <button class="btn-prime" style="padding:10px; font-size:12px; border-radius:12px;">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                    <button class="btn-prime" style="padding:10px; font-size:12px; border-radius:12px; background:var(--glass); color:#fff; border:1px solid var(--border);" onclick="handleLogout()">–í—ã–π—Ç–∏</button>
                </div>
            </div>

            <div class="setting-group">
                <span class="setting-label">–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è</span>
                <div class="setting-item">
                    <span>–¶–≤–µ—Ç —Å–∏—Å—Ç–µ–º—ã</span>
                    <select id="set-accent" onchange="applySettings()">
                        <option value="#00f2ff">–¶–∏–∞–Ω</option>
                        <option value="#ff00f2">–ú–∞–¥–∂–µ–Ω—Ç–∞</option>
                        <option value="#ffd700">–ó–æ–ª–æ—Ç–æ</option>
                        <option value="#00ff88">–ù–µ–æ–Ω</option>
                    </select>
                </div>
                <div class="setting-item">
                    <span>–†–∞–∑–º—ã—Ç–∏–µ (Blur)</span>
                    <input type="range" id="set-blur" min="0" max="50" value="25" oninput="applySettings()">
                </div>
                <div class="setting-item">
                    <span>–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ (px)</span>
                    <input type="range" id="set-radius" min="0" max="50" value="35" oninput="applySettings()">
                </div>
            </div>

            <div class="setting-group">
                <span class="setting-label">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</span>
                <div class="setting-item">
                    <span>Email</span>
                    <span id="u-email" style="opacity:0.5;">...</span>
                </div>
                <div class="setting-item">
                    <span>ID –°–µ—Å—Å–∏–∏</span>
                    <span style="opacity:0.3; font-family:monospace; font-size:10px;">SPK-882-ULTRA</span>
                </div>
            </div>
        </section>
        
        <div class="island-controller">
            <nav class="island-nav">
                <div class="nav-link active" onclick="go('chat', this)">üí¨</div>
                <div class="nav-link" onclick="go('profile', this)">üë§</div>
            </nav>
        </div>
    </div>

    <script>
        let db;
        let currentUser = null;

        // DB INIT
        const req = indexedDB.open("SpeekyUltraDB", 1);
        req.onupgradeneeded = (e) => {
            db = e.target.result;
            db.createObjectStore("users", { keyPath: "email" });
        };
        req.onsuccess = (e) => { db = e.target.result; checkSession(); };

        function toggleForm(id) {
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function handleRegister() {
            const user = {
                nick: document.getElementById('r-nick').value,
                email: document.getElementById('r-email').value,
                pass: document.getElementById('r-pass').value,
                secret: document.getElementById('r-secret').value.toLowerCase(),
                bio: "–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ–±–µ",
                settings: { accent: "#00f2ff", blur: "25", radius: "35" }
            };
            db.transaction("users", "readwrite").objectStore("users").add(user).onsuccess = () => toggleForm('auth-login');
        }

        function handleLogin() {
            const email = document.getElementById('l-email').value;
            const pass = document.getElementById('l-pass').value;
            db.transaction("users").objectStore("users").get(email).onsuccess = (e) => {
                const u = e.target.result;
                if(u && u.pass === pass) {
                    localStorage.setItem('spk_u_session', JSON.stringify(u));
                    runIntro(u);
                } else alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞");
            };
        }

        function runIntro(u) {
            document.getElementById('auth-layer').style.display = 'none';
            const overlay = document.getElementById('welcome-overlay');
            overlay.style.display = 'flex';
            document.getElementById('intro-name').innerText = `–ü—Ä–∏–≤–µ—Ç, ${u.nick}`;
            
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    overlay.style.display = 'none';
                    location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
                }, 1000);
            }, 2500);
        }

        function checkSession() {
            const s = localStorage.getItem('spk_u_session');
            if(s) {
                currentUser = JSON.parse(s);
                document.getElementById('auth-layer').style.display = 'none';
                document.getElementById('app').style.display = 'flex';
                document.getElementById('app').style.opacity = '1';
                syncUI();
            }
        }

        function syncUI() {
            document.getElementById('u-nick').innerText = currentUser.nick;
            document.getElementById('u-email').innerText = currentUser.email;
            document.getElementById('u-bio').value = currentUser.bio;
            document.getElementById('u-avatar').innerText = currentUser.nick[0].toUpperCase();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            if(currentUser.settings) {
                document.getElementById('set-accent').value = currentUser.settings.accent;
                document.getElementById('set-blur').value = currentUser.settings.blur;
                document.getElementById('set-radius').value = currentUser.settings.radius;
                applySettings(false);
            }
        }

        function applySettings(save = true) {
            const accent = document.getElementById('set-accent').value;
            const blur = document.getElementById('set-blur').value;
            const radius = document.getElementById('set-radius').value;

            document.documentElement.style.setProperty('--accent', accent);
            document.documentElement.style.setProperty('--blur', blur + 'px');
            document.documentElement.style.setProperty('--radius', radius + 'px');

            if(save) {
                currentUser.settings = { accent, blur, radius };
                updateDB();
            }
        }

        function updateProfile() {
            currentUser.bio = document.getElementById('u-bio').value;
            updateDB();
        }

        function updateDB() {
            const tx = db.transaction("users", "readwrite");
            tx.objectStore("users").put(currentUser);
            localStorage.setItem('spk_u_session', JSON.stringify(currentUser));
        }

        function go(screen, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('sc-' + screen).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
        }

        function handleLogout() {
            localStorage.removeItem('spk_u_session');
            location.reload();
        }
    </script>
</body>
</html>
