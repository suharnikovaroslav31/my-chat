<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA PRO | Эволюция общения</title>
    <style>
        :root {
            --accent: #00d2ff;
            --accent-deep: #0088ff;
            --glass: rgba(255, 255, 255, 0.02);
            --border: rgba(255, 255, 255, 0.1);
            --text: #e0e6ed;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: #030508; color: var(--text);
            font-family: 'Inter', -apple-system, sans-serif;
            height: 100vh; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
        }

        /* АНИМИРОВАННЫЙ ТУМАН */
        .fog-bg {
            position: fixed; inset: 0; z-index: -1;
            background: radial-gradient(circle at 50% 50%, #0a111a, #030508);
        }
        .blob {
            position: absolute; width: 800px; height: 800px;
            background: radial-gradient(circle, rgba(0, 210, 255, 0.08) 0%, transparent 70%);
            filter: blur(100px); animation: float 20s infinite alternate ease-in-out;
        }
        @keyframes float {
            0% { transform: translate(-20%, -20%) scale(1); }
            100% { transform: translate(20%, 20%) scale(1.3); }
        }

        /* ЭКРАН РЕГИСТРАЦИИ / ВХОДА */
        #auth-container {
            width: 450px; perspective: 1000px; z-index: 10;
        }
        .auth-card {
            background: rgba(10, 15, 25, 0.7); backdrop-filter: blur(30px);
            padding: 40px; border-radius: 40px; border: 1px solid var(--border);
            box-shadow: 0 50px 100px rgba(0,0,0,0.8);
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .step { display: none; animation: fadeIn 0.5s ease forwards; }
        .step.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { font-size: 28px; font-weight: 900; margin-bottom: 10px; background: linear-gradient(to right, #fff, var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        p.desc { font-size: 14px; color: #6a7c92; margin-bottom: 25px; line-height: 1.6; }

        input {
            width: 100%; padding: 18px; margin-bottom: 15px; border-radius: 20px;
            border: 1px solid var(--border); background: rgba(0,0,0,0.4);
            color: #fff; font-size: 16px; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--accent); box-shadow: 0 0 20px rgba(0, 210, 255, 0.15); }

        .btn-next {
            width: 100%; padding: 18px; background: var(--accent); color: #000;
            border: none; border-radius: 20px; font-weight: 800; font-size: 16px;
            cursor: pointer; transition: 0.3s; transform: translateY(0);
        }
        .btn-next:hover { transform: translateY(-3px); box-shadow: 0 10px 25px var(--accent-glow); }

        /* ИНТЕРФЕЙС ЧАТА */
        #main-app {
            display: none; width: 98vw; height: 96vh;
            background: var(--glass); backdrop-filter: blur(60px);
            border: 1px solid var(--border); border-radius: 35px;
            grid-template-columns: 300px 1fr 260px;
            opacity: 0; transform: scale(0.95);
            transition: all 1s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* ПРИВЕТСТВЕННЫЙ ЭКРАН */
        #welcome-screen {
            position: fixed; inset: 0; z-index: 100; background: #030508;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }

        /* ПЛЮСЫ (Список в регистрации) */
        .features { margin: 20px 0; text-align: left; }
        .feature-item { font-size: 13px; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; color: #a0aec0; }
        .feature-item i { color: var(--accent); }
    </style>
</head>
<body>

    <div class="fog-bg"><div class="blob"></div></div>

    <div id="auth-container">
        <div class="auth-card">
            <div class="step active" id="step1">
                <h2>ULTRA PRO</h2>
                <p class="desc">Добро пожаловать в новое поколение конфиденциального общения.</p>
                <div class="features">
                    <div class="feature-item">✦ Сквозное шифрование сообщений</div>
                    <div class="feature-item">✦ Кастомизация профиля в реальном времени</div>
                    <div class="feature-item">✦ Скорость отклика менее 10мс</div>
                </div>
                <button class="btn-next" onclick="nextStep(2)">ПРИСОЕДИНИТЬСЯ</button>
                <p style="margin-top: 20px; font-size: 12px; opacity: 0.5; text-align: center; cursor: pointer;" onclick="toggleLogin()">Уже есть аккаунт? Войти</p>
            </div>

            <div class="step" id="step2">
                <h2 id="auth-title">Создай аккаунт</h2>
                <p class="desc" id="auth-desc">Придумай уникальный позывной для входа в сеть.</p>
                <input type="text" id="username" placeholder="Ваш никнейм">
                <input type="password" id="password" placeholder="Надежный пароль">
                <button class="btn-next" id="main-auth-btn" onclick="handleAuth()">ЗАПУСТИТЬ ЯДРО</button>
                <p style="margin-top: 15px; font-size: 12px; cursor: pointer; text-align: center;" onclick="nextStep(1)">← Назад</p>
            </div>
        </div>
    </div>

    <div id="welcome-screen">
        <h1 id="welcome-msg" style="font-size: 48px; letter-spacing: 10px; opacity: 0;">ДОСТУП РАЗРЕШЕН</h1>
        <p id="welcome-sub" style="margin-top: 20px; color: var(--accent); opacity: 0;">ЗАГРУЗКА ВАШЕГО ПРОСТРАНСТВА...</p>
    </div>

    <div id="main-app">
        <aside style="border-right: 1px solid var(--border); display: flex; flex-direction: column; background: rgba(0,0,0,0.2);">
            <div style="padding: 40px 30px; font-weight: 900; letter-spacing: 3px; color: var(--accent);">СЕКТОРЫ</div>
            <div style="padding: 15px 30px; background: var(--accent-glow); color: var(--accent); border-left: 3px solid var(--accent);"># основной-чат</div>
            <div style="padding: 15px 30px; opacity: 0.4;"># медиа-файлы</div>
            
            <div style="margin-top: auto; padding: 30px; border-top: 1px solid var(--border);">
                <div id="my-profile" style="display: flex; align-items: center; gap: 15px; cursor: pointer;">
                    <div style="width: 45px; height: 45px; border-radius: 15px; background: linear-gradient(45deg, var(--accent), #7000ff);"></div>
                    <div>
                        <div id="user-display-name" style="font-weight: 800;">Username</div>
                        <div style="font-size: 10px; color: #00ff88;">● В СЕТИ</div>
                    </div>
                </div>
            </div>
        </aside>

        <main style="display: flex; flex-direction: column;">
            <header style="padding: 25px 40px; border-bottom: 1px solid var(--border); font-weight: bold;"># основной-чат</header>
            <div id="messages" style="flex: 1; padding: 40px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px;"></div>
            <div style="padding: 30px;">
                <form id="chat-form" style="background: rgba(0,0,0,0.3); padding: 10px 25px; border-radius: 25px; border: 1px solid var(--border); display: flex; gap: 15px;">
                    <input type="text" id="msg-input" placeholder="Введите сообщение..." style="background: none; border: none; margin: 0; padding: 10px;" autocomplete="off">
                    <button type="submit" style="background: none; border: none; color: var(--accent); font-weight: 900; cursor: pointer;">ОТПРАВИТЬ</button>
                </form>
            </div>
        </main>

        <aside style="border-left: 1px solid var(--border); padding: 40px 25px; background: rgba(0,0,0,0.1);">
            <div style="font-size: 11px; font-weight: 900; color: #445; letter-spacing: 2px; margin-bottom: 20px;">АКТИВНЫЕ ЮЗЕРЫ</div>
            <div id="user-list">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <div style="width: 8px; height: 8px; border-radius: 50%; background: #00ff88; box-shadow: 0 0 10px #00ff88;"></div>
                    <span style="font-size: 14px;">ярослав</span>
                </div>
            </div>
        </aside>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let isRegisterMode = true;

        function nextStep(stepNum) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + stepNum).classList.add('active');
        }

        function toggleLogin() {
            isRegisterMode = false;
            document.getElementById('auth-title').innerText = "С возвращением";
            document.getElementById('auth-desc').innerText = "Введите ваши данные для входа в систему.";
            document.getElementById('main-auth-btn').innerText = "ВОЙТИ В СЕТЬ";
            nextStep(2);
        }

        function handleAuth() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            if(!u || !p) return alert("Заполни все поля, боец!");
            socket.emit('authenticate', { username: u, password: p, isRegister: isRegisterMode });
        }

        socket.on('auth_success', d => {
            window.myName = d.username;
            // Анимация исчезновения авторизации
            document.getElementById('auth-container').style.opacity = '0';
            document.getElementById('auth-container').style.transform = 'scale(0.8)';
            
            setTimeout(() => {
                document.getElementById('auth-container').style.display = 'none';
                const ws = document.getElementById('welcome-screen');
                ws.style.display = 'flex';
                
                // Плавное приветствие
                setTimeout(() => {
                    document.getElementById('welcome-msg').style.transition = '2s';
                    document.getElementById('welcome-msg').style.opacity = '1';
                    document.getElementById('welcome-msg').innerText = "ПРИВЕТ, " + d.username.toUpperCase();
                }, 100);

                setTimeout(() => {
                    document.getElementById('welcome-sub').style.transition = '1s';
                    document.getElementById('welcome-sub').style.opacity = '1';
                }, 1200);

                // Переход в чат
                setTimeout(() => {
                    ws.style.opacity = '0';
                    ws.style.transition = '1.5s';
                    setTimeout(() => {
                        ws.style.display = 'none';
                        const app = document.getElementById('main-app');
                        app.style.display = 'grid';
                        setTimeout(() => {
                            app.style.opacity = '1';
                            app.style.transform = 'scale(1)';
                        }, 50);
                    }, 1500);
                }, 4000);
            }, 800);

            document.getElementById('user-display-name').innerText = d.username;
            socket.emit('join_room', 'основной-чат');
        });

        socket.on('message', m => {
            const wrap = document.createElement('div');
            const isMe = m.name === window.myName;
            wrap.style.alignSelf = isMe ? 'flex-end' : 'flex-start';
            wrap.style.maxWidth = '70%';
            
            wrap.innerHTML = `
                <div style="font-size: 10px; color: var(--accent); margin-bottom: 5px; font-weight: bold; text-align: ${isMe ? 'right' : 'left'}">${m.name}</div>
                <div style="background: ${isMe ? 'rgba(0, 210, 255, 0.1)' : 'rgba(255,255,255,0.03)'}; 
                            padding: 15px 20px; border-radius: 20px; border: 1px solid var(--border);
                            line-height: 1.5; color: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
                    ${m.text}
                </div>
            `;
            document.getElementById('messages').appendChild(wrap);
            document.getElementById('messages').scrollTop = 99999;
        });

        document.getElementById('chat-form').onsubmit = (e) => {
            e.preventDefault();
            const i = document.getElementById('msg-input');
            if(i.value) {
                socket.emit('message', { text: i.value });
                i.value = '';
            }
        };
    </script>
</body>
</html>
