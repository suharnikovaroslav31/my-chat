<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA TG-STYLE PRO</title>
    <style>
        :root {
            --accent: #00d2ff;
            --bg: #0e1621; /* –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ç–µ–º–Ω—ã–π –¢–ì */
            --side: #17212b;
            --panel: #242f3d;
            --text: #ffffff;
            --text-dim: #708499;
            --msg-in: #182533;
            --msg-out: #2b5278;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–º–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç JS */
        body.glass-mode { --bg: #05070a; }
        body.glass-mode .sidebar, body.glass-mode .rail { backdrop-filter: blur(20px); background: rgba(23, 33, 43, 0.7); }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; }

        /* –≠–ö–†–ê–ù –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò */
        #auth-page { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; align-items: center; justify-content: center; transition: 0.5s; }
        .auth-box { width: 360px; text-align: center; animation: fadeIn 0.8s ease; }
        .auth-box h2 { font-weight: 500; margin-bottom: 10px; }
        .auth-box p { color: var(--text-dim); margin-bottom: 30px; font-size: 14px; }
        .tg-input { width: 100%; padding: 12px 0; border: none; border-bottom: 2px solid var(--accent); background: none; color: #fff; font-size: 18px; outline: none; margin-bottom: 20px; }
        .tg-btn { width: 100%; padding: 14px; background: var(--accent); border: none; border-radius: 8px; color: #fff; font-weight: 600; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }

        /* –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        .rail { width: 72px; background: var(--side); display: flex; flex-direction: column; align-items: center; padding: 20px 0; border-right: 1px solid rgba(0,0,0,0.2); }
        .rail-item { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; margin-bottom: 15px; font-size: 20px; transition: 0.2s; }
        .rail-item:hover { background: rgba(255,255,255,0.05); }
        .rail-item.active { background: var(--accent); color: white; }

        .sidebar { width: 300px; background: var(--side); border-right: 1px solid rgba(0,0,0,0.2); display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; font-weight: 600; display: flex; align-items: center; gap: 15px; }

        .chat-view { flex: 1; display: flex; flex-direction: column; background: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded17.png'); background-size: cover; }
        .chat-header { height: 60px; background: var(--side); display: flex; align-items: center; padding: 0 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 8px; }
        .msg { max-width: 70%; padding: 8px 12px; border-radius: 12px; font-size: 14px; position: relative; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .msg.in { align-self: flex-start; background: var(--msg-in); border-bottom-left-radius: 2px; }
        .msg.out { align-self: flex-end; background: var(--msg-out); border-bottom-right-radius: 2px; }
        .msg-name { font-weight: 600; font-size: 12px; color: var(--accent); margin-bottom: 4px; }

        .input-bar { padding: 10px 20px; background: var(--side); display: flex; align-items: center; gap: 15px; }
        .input-bar input { flex: 1; background: none; border: none; color: #fff; font-size: 16px; outline: none; }

        /* –ü–ê–ù–ï–õ–¨ –ù–ê–°–¢–†–û–ï–ö (TG STYLE) */
        #settings-drawer { position: fixed; left: -310px; top: 0; bottom: 0; width: 300px; background: var(--side); z-index: 5000; transition: 0.3s; display: flex; flex-direction: column; box-shadow: 10px 0 30px rgba(0,0,0,0.5); }
        #settings-drawer.open { left: 0; }
        .drawer-header { background: var(--panel); padding: 30px 20px; }
        .avatar-big { width: 60px; height: 60px; border-radius: 50%; background: var(--accent); margin-bottom: 15px; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700; }
        .drawer-list { padding: 10px 0; }
        .drawer-item { padding: 15px 20px; display: flex; align-items: center; gap: 20px; cursor: pointer; transition: 0.2s; }
        .drawer-item:hover { background: rgba(255,255,255,0.05); }

        /* –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ */
        .toggle { width: 34px; height: 14px; background: #515e6b; border-radius: 10px; position: relative; margin-left: auto; cursor: pointer; }
        .toggle.on { background: rgba(0, 210, 255, 0.5); }
        .toggle::after { content: ''; position: absolute; width: 20px; height: 20px; background: #cedbe6; border-radius: 50%; top: -3px; left: -2px; transition: 0.2s; }
        .toggle.on::after { left: 18px; background: var(--accent); }

        .hidden-page { display: none !important; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } }
    </style>
</head>
<body>

    <div id="auth-page">
        <div class="auth-box">
            <div style="font-size: 60px; margin-bottom: 20px;">üíé</div>
            <h2>ULTRA MESSENGER</h2>
            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è.</p>
            <input type="text" id="reg-user" class="tg-input" placeholder="–í–∞—à–µ –∏–º—è">
            <input type="password" id="reg-pass" class="tg-input" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="tg-btn" onclick="register()">–ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</button>
        </div>
    </div>

    <div id="settings-drawer">
        <div class="drawer-header">
            <div class="avatar-big" id="prof-ava">U</div>
            <div style="font-weight: 600;" id="prof-name">User Name</div>
            <div style="font-size: 13px; color: var(--text-dim);" id="prof-status">Online</div>
        </div>
        <div class="drawer-list">
            <div class="drawer-item"><span>üë§</span> –ü—Ä–æ—Ñ–∏–ª—å</div>
            <div class="drawer-item" onclick="toggleSetting('glass')">
                <span>‚ú®</span> Glass Mode 
                <div class="toggle" id="t-glass"></div>
            </div>
            <div class="drawer-item" onclick="toggleSetting('anim')">
                <span>üöÄ</span> –ê–Ω–∏–º–∞—Ü–∏–∏ 
                <div class="toggle on" id="t-anim"></div>
            </div>
            <div class="drawer-item" style="color: #ff595a;" onclick="location.reload()"><span>üö™</span> –í—ã—Ö–æ–¥</div>
        </div>
    </div>

    <nav class="rail">
        <div class="rail-item" onclick="document.getElementById('settings-drawer').classList.add('open')">‚ò∞</div>
        <div class="rail-item active">üí¨</div>
        <div class="rail-item">üë§</div>
        <div class="rail-item" style="margin-top: auto;">üåô</div>
    </nav>

    <aside class="sidebar">
        <div class="sidebar-header">
            <span>–ß–∞—Ç</span>
            <div style="margin-left: auto; font-size: 12px; color: var(--accent);">
                –û–Ω–ª–∞–π–Ω: <span id="online-count">0</span>
            </div>
        </div>
        <div style="padding: 10px 20px; background: var(--panel); margin: 0 10px; border-radius: 8px; font-size: 14px; cursor: pointer;">
            <b># –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª</b>
        </div>
    </aside>

    <main class="chat-view" onclick="document.getElementById('settings-drawer').classList.remove('open')">
        <header class="chat-header">
            <div style="font-weight: 600;"># –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª</div>
        </header>
        <div id="messages"></div>
        <form class="input-bar" id="chat-form">
            <span>üìé</span>
            <input type="text" id="m-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
            <button type="submit" style="background:none; border:none; color:var(--accent); font-weight:700; cursor:pointer;">–û–¢–ü–†–ê–í–ò–¢–¨</button>
        </form>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentUser = null;

        // 1. –ù–ê–°–¢–û–Ø–©–ê–Ø –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø (–ò–ú–ò–¢–ê–¶–ò–Ø –î–õ–Ø –ë–ê–ó–´)
        function register() {
            const user = document.getElementById('reg-user').value;
            const pass = document.getElementById('reg-pass').value;
            if(!user || !pass) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!");

            currentUser = { name: user, id: socket.id };
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            socket.emit('authenticate', { username: user, password: pass, isRegister: true });
        }

        socket.on('auth_success', (data) => {
            document.getElementById('auth-page').classList.add('hidden-page');
            document.getElementById('prof-name').innerText = currentUser.name;
            document.getElementById('prof-ava').innerText = currentUser.name[0].toUpperCase();
            socket.emit('join_room', 'main');
        });

        // 2. –†–ê–ë–û–ß–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò
        const settings = { glass: false, anim: true };
        function toggleSetting(type) {
            settings[type] = !settings[type];
            document.getElementById('t-' + type).classList.toggle('on');
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            if(type === 'glass') {
                document.body.classList.toggle('glass-mode', settings.glass);
            }
            if(type === 'anim') {
                // –ï—Å–ª–∏ –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—ã–∫–ª—é—á–µ–Ω—ã, —É–±–∏—Ä–∞–µ–º –∏—Ö –∏–∑ —Å—Ç–∏–ª–µ–π
                const messages = document.getElementById('messages');
                messages.style.setProperty('--anim-duration', settings.anim ? '0.3s' : '0s');
            }
        }

        // 3. –°–ß–ï–¢–ß–ò–ö –ò –°–û–û–ë–©–ï–ù–ò–Ø
        socket.on('update_online', count => {
            document.getElementById('online-count').innerText = count;
        });

        document.getElementById('chat-form').onsubmit = (e) => {
            e.preventDefault();
            const input = document.getElementById('m-input');
            if(input.value) {
                socket.emit('message', { text: input.value });
                input.value = '';
            }
        };

        socket.on('message', m => {
            const wrap = document.getElementById('messages');
            const isMe = m.name === currentUser.name;
            const div = document.createElement('div');
            div.className = `msg ${isMe ? 'out' : 'in'}`;
            div.innerHTML = `
                ${!isMe ? `<div class="msg-name">${m.name}</div>` : ''}
                <div class="msg-text">${m.text}</div>
            `;
            wrap.appendChild(div);
            wrap.scrollTop = wrap.scrollHeight;
        });
    </script>
</body>
</html>
